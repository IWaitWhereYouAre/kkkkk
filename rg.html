<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.7px Arial; -webkit-text-stroke: #000000}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000; min-height: 14.0px}
    span.s1 {font-kerning: none}
    span.s2 {font-kerning: none; color: #181818; background-color: #ffffff; -webkit-text-stroke: 0px #181818}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="en"&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1">  &lt;meta charset="UTF-8" /&gt;</span></p>
<p class="p1"><span class="s1">  &lt;meta</span></p>
<p class="p1"><span class="s1">    name="viewport"</span></p>
<p class="p1"><span class="s1">    content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1"</span></p>
<p class="p1"><span class="s1">  /&gt;</span></p>
<p class="p1"><span class="s1">  &lt;meta name="theme-color" content="#FFFBF4" /&gt;</span></p>
<p class="p1"><span class="s1">  &lt;title&gt;Heart to Heart | ISA Chulalongkorn&lt;/title&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">  &lt;!-- html2canvas (works on iOS/Android/Desktop; saving handled with robust fallback below) --&gt;</span></p>
<p class="p1"><span class="s1">  &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"</span></p>
<p class="p1"><span class="s1">          integrity="sha512-BNa5lR0o8q+4d2mWcP1bB7P0P0qQ7Qy0cJQ8o0c5o6WmU6xF2w0o3oWqv3bW0oZxkqQw6xj9tq8u0p1p0Q=="</span></p>
<p class="p1"><span class="s1">          crossorigin="anonymous" referrerpolicy="no-referrer"&gt;&lt;/script&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">  &lt;style&gt;</span></p>
<p class="p1"><span class="s1">    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&amp;family=Lato:wght@300;400&amp;family=Pinyon+Script&amp;display=swap');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       GLOBAL TOKENS (NO BLACK)</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    :root{</span></p>
<p class="p1"><span class="s1">      --ink: #3A2430;            /* deep wine-ink (not black) */</span></p>
<p class="p1"><span class="s1">      --porcelain: #FFFBF4;      /* warm cream */</span></p>
<p class="p1"><span class="s1">      --cream: #F8F5F0;</span></p>
<p class="p1"><span class="s1">      --cream-2: #FBF3E6;</span></p>
<p class="p1"><span class="s1">      --champagne: #F3E4C8;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      /* Deep Wine + Gold (Act I) */</span></p>
<p class="p1"><span class="s1">      --wine: #5A0F1B;</span></p>
<p class="p1"><span class="s1">      --wine-2: #7B1E2B;</span></p>
<p class="p1"><span class="s1">      --rose: #B21E35;</span></p>
<p class="p1"><span class="s1">      --gold: #D4AF37;</span></p>
<p class="p1"><span class="s1">      --old-gold: #C9A24A;</span></p>
<p class="p1"><span class="s1">      --ivory: #FFF2DF;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      /* Garden (Act II) */</span></p>
<p class="p1"><span class="s1">      --deep-green: #1A2A1D;</span></p>
<p class="p1"><span class="s1">      --sage: #E6EFE7;</span></p>
<p class="p1"><span class="s1">      --blush: #E8D5D1;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      /* RGB helpers */</span></p>
<p class="p1"><span class="s1">      --wine-rgb: 90,15,27;</span></p>
<p class="p1"><span class="s1">      --wine2-rgb: 123,30,43;</span></p>
<p class="p1"><span class="s1">      --rose-rgb: 178,30,53;</span></p>
<p class="p1"><span class="s1">      --gold-rgb: 212,175,55;</span></p>
<p class="p1"><span class="s1">      --green-rgb: 26,42,29;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      /* =========================</span></p>
<p class="p1"><span class="s1">         ACT A — VALENTINE REDS (NO GREEN)</span></p>
<p class="p1"><span class="s1">         ========================= */</span></p>
<p class="p1"><span class="s1">      --val-crimson: #C3163A;</span></p>
<p class="p1"><span class="s1">      --val-wine:    #5A0F1B;</span></p>
<p class="p1"><span class="s1">      --val-velvet:  #7A0624;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      --valentine-grad: linear-gradient(135deg,</span></p>
<p class="p1"><span class="s1">        var(--val-crimson) 0%,</span></p>
<p class="p1"><span class="s1">        var(--val-wine) 50%,</span></p>
<p class="p1"><span class="s1">        var(--val-velvet) 100%</span></p>
<p class="p1"><span class="s1">      );</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      --valentine-glow: radial-gradient(780px 520px at 50% 26%,</span></p>
<p class="p1"><span class="s1">        rgba(195,22,58,0.34),</span></p>
<p class="p1"><span class="s1">        rgba(90,15,27,0.00) 66%</span></p>
<p class="p1"><span class="s1">      );</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      /* App base (overridden per view) */</span></p>
<p class="p1"><span class="s1">      --bg: var(--porcelain);</span></p>
<p class="p1"><span class="s1">      --fg: var(--ink);</span></p>
<p class="p1"><span class="s1">      --card: rgba(255,255,255,0.62);</span></p>
<p class="p1"><span class="s1">      --stroke: rgba(58,36,48,0.12);</span></p>
<p class="p1"><span class="s1">      --shadow: 0 22px 60px rgba(58,36,48,0.14);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      /* Safe-area */</span></p>
<p class="p1"><span class="s1">      --safe-top: env(safe-area-inset-top, 0px);</span></p>
<p class="p1"><span class="s1">      --safe-bottom: env(safe-area-inset-bottom, 0px);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* Reduce motion accessibility */</span></p>
<p class="p1"><span class="s1">    @media (prefers-reduced-motion: reduce){</span></p>
<p class="p1"><span class="s1">      * { animation: none !important; transition: none !important; scroll-behavior: auto !important; }</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    html, body{</span></p>
<p class="p1"><span class="s1">      width:100%; height:100%;</span></p>
<p class="p1"><span class="s1">      margin:0; padding:0;</span></p>
<p class="p1"><span class="s1">      background: var(--bg);</span></p>
<p class="p1"><span class="s1">      color: var(--fg);</span></p>
<p class="p1"><span class="s1">      font-family: 'Lato', sans-serif;</span></p>
<p class="p1"><span class="s1">      -webkit-text-size-adjust:100%;</span></p>
<p class="p1"><span class="s1">      text-size-adjust:100%;</span></p>
<p class="p1"><span class="s1">      touch-action: manipulation;</span></p>
<p class="p1"><span class="s1">      overscroll-behavior: none;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    body{</span></p>
<p class="p1"><span class="s1">      min-height: 100svh;</span></p>
<p class="p1"><span class="s1">      overflow: hidden;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* Better tap feel */</span></p>
<p class="p1"><span class="s1">    button, [role="button"], .home-card, .trait, .card{</span></p>
<p class="p1"><span class="s1">      -webkit-tap-highlight-color: transparent;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* App wrapper becomes scroll container */</span></p>
<p class="p1"><span class="s1">    #app{</span></p>
<p class="p1"><span class="s1">      height: 100svh;</span></p>
<p class="p1"><span class="s1">      overflow-y: auto;</span></p>
<p class="p1"><span class="s1">      -webkit-overflow-scrolling: touch;</span></p>
<p class="p1"><span class="s1">      position: relative;</span></p>
<p class="p1"><span class="s1">      padding-bottom: var(--safe-bottom);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    .view{</span></p>
<p class="p1"><span class="s1">      display:none;</span></p>
<p class="p1"><span class="s1">      min-height: 100svh;</span></p>
<p class="p1"><span class="s1">      box-sizing: border-box;</span></p>
<p class="p1"><span class="s1">      position: relative;</span></p>
<p class="p1"><span class="s1">      padding: calc(22px + var(--safe-top)) 20px calc(70px + var(--safe-bottom));</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .view.active{ display:block; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       NAV</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    .topbar{</span></p>
<p class="p1"><span class="s1">      width: min(1100px, 96vw);</span></p>
<p class="p1"><span class="s1">      margin: 0 auto 14px;</span></p>
<p class="p1"><span class="s1">      display:flex;</span></p>
<p class="p1"><span class="s1">      justify-content: space-between;</span></p>
<p class="p1"><span class="s1">      gap: 10px;</span></p>
<p class="p1"><span class="s1">      align-items:center;</span></p>
<p class="p1"><span class="s1">      flex-wrap: wrap;</span></p>
<p class="p1"><span class="s1">      position: relative;</span></p>
<p class="p1"><span class="s1">      z-index: 30;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .navbtn{</span></p>
<p class="p1"><span class="s1">      border: 1px solid rgba(255,255,255,0.20);</span></p>
<p class="p1"><span class="s1">      background: linear-gradient(135deg,</span></p>
<p class="p1"><span class="s1">        rgba(255,255,255,0.58),</span></p>
<p class="p1"><span class="s1">        rgba(255,255,255,0.34)</span></p>
<p class="p1"><span class="s1">      );</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.92);</span></p>
<p class="p1"><span class="s1">      backdrop-filter: blur(14px);</span></p>
<p class="p1"><span class="s1">      padding: 11px 14px;</span></p>
<p class="p1"><span class="s1">      border-radius: 14px;</span></p>
<p class="p1"><span class="s1">      font-size: 0.72rem;</span></p>
<p class="p1"><span class="s1">      letter-spacing: 2.2px;</span></p>
<p class="p1"><span class="s1">      text-transform: uppercase;</span></p>
<p class="p1"><span class="s1">      cursor: pointer;</span></p>
<p class="p1"><span class="s1">      transition: transform .18s ease, border-color .18s ease, box-shadow .18s ease;</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 14px 40px rgba(58,36,48,0.12);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .navbtn:hover{</span></p>
<p class="p1"><span class="s1">      transform: translateY(-1px);</span></p>
<p class="p1"><span class="s1">      border-color: rgba(255,255,255,0.40);</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 18px 50px rgba(58,36,48,0.16);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .navbtn:focus-visible{</span></p>
<p class="p1"><span class="s1">      outline: 2px solid rgba(var(--gold-rgb),0.55);</span></p>
<p class="p1"><span class="s1">      outline-offset: 3px;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       LAYERS (swapped per view)</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    .layer{</span></p>
<p class="p1"><span class="s1">      position: fixed;</span></p>
<p class="p1"><span class="s1">      inset: 0;</span></p>
<p class="p1"><span class="s1">      pointer-events: none;</span></p>
<p class="p1"><span class="s1">      z-index: 0;</span></p>
<p class="p1"><span class="s1">      display:none;</span></p>
<p class="p1"><span class="s1">      transform: translateZ(0);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .layer.on{ display:block; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* Soft luxury vignette */</span></p>
<p class="p1"><span class="s1">    .vignette{</span></p>
<p class="p1"><span class="s1">      position:fixed; inset:0;</span></p>
<p class="p1"><span class="s1">      pointer-events:none;</span></p>
<p class="p1"><span class="s1">      z-index:6;</span></p>
<p class="p1"><span class="s1">      background:</span></p>
<p class="p1"><span class="s1">        radial-gradient(1200px 800px at 50% 20%, rgba(255,255,255,0.0) 60%, rgba(58,36,48,0.10) 100%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(1200px 900px at 50% 120%, rgba(255,255,255,0.0) 58%, rgba(58,36,48,0.12) 100%);</span></p>
<p class="p1"><span class="s1">      mix-blend-mode:multiply;</span></p>
<p class="p1"><span class="s1">      opacity:0.55;</span></p>
<p class="p1"><span class="s1">      display:none;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .vignette.on{ display:block; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       HOME</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    #home{</span></p>
<p class="p1"><span class="s1">      --bg: var(--porcelain);</span></p>
<p class="p1"><span class="s1">      --fg: var(--ink);</span></p>
<p class="p1"><span class="s1">      background:</span></p>
<p class="p1"><span class="s1">        radial-gradient(900px 600px at 16% 18%, rgba(var(--gold-rgb),0.22), transparent 62%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(880px 620px at 84% 28%, rgba(var(--rose-rgb),0.16), transparent 62%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(900px 680px at 32% 88%, rgba(var(--green-rgb),0.10), transparent 62%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(900px 700px at 76% 92%, rgba(232,213,209,0.28), transparent 62%),</span></p>
<p class="p1"><span class="s1">        linear-gradient(135deg, #FFF9F0 0%, #FFF4E8 55%, #FFFDF7 100%);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .home-wrap{</span></p>
<p class="p1"><span class="s1">      width: min(980px, 94vw);</span></p>
<p class="p1"><span class="s1">      margin: 0 auto;</span></p>
<p class="p1"><span class="s1">      text-align:center;</span></p>
<p class="p1"><span class="s1">      padding-top: 26px;</span></p>
<p class="p1"><span class="s1">      position: relative;</span></p>
<p class="p1"><span class="s1">      z-index: 10;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .isa-tag{</span></p>
<p class="p1"><span class="s1">      font-size:0.62rem;</span></p>
<p class="p1"><span class="s1">      letter-spacing:3.2px;</span></p>
<p class="p1"><span class="s1">      margin-bottom:8px;</span></p>
<p class="p1"><span class="s1">      opacity:0.78;</span></p>
<p class="p1"><span class="s1">      text-transform:uppercase;</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.72);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    h1.main-title{</span></p>
<p class="p1"><span class="s1">      font-family:'Pinyon Script', cursive;</span></p>
<p class="p1"><span class="s1">      font-size:clamp(3.2rem, 12vw, 6.2rem);</span></p>
<p class="p1"><span class="s1">      margin:0;</span></p>
<p class="p1"><span class="s1">      line-height:1.05;</span></p>
<p class="p1"><span class="s1">      background: linear-gradient(135deg,</span></p>
<p class="p1"><span class="s1">        rgba(var(--gold-rgb),0.98),</span></p>
<p class="p1"><span class="s1">        rgba(var(--rose-rgb),0.90),</span></p>
<p class="p1"><span class="s1">        rgba(var(--wine2-rgb),0.92)</span></p>
<p class="p1"><span class="s1">      );</span></p>
<p class="p1"><span class="s1">      -webkit-background-clip:text;</span></p>
<p class="p1"><span class="s1">      background-clip:text;</span></p>
<p class="p1"><span class="s1">      color: transparent;</span></p>
<p class="p1"><span class="s1">      text-shadow: 0 18px 50px rgba(58,36,48,0.10);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .sub-theme{</span></p>
<p class="p1"><span class="s1">      font-family:'Playfair Display', serif;</span></p>
<p class="p1"><span class="s1">      font-size:clamp(0.75rem, 2vw, 1.02rem);</span></p>
<p class="p1"><span class="s1">      letter-spacing:clamp(4px,1vw,10px);</span></p>
<p class="p1"><span class="s1">      text-transform:uppercase;</span></p>
<p class="p1"><span class="s1">      margin: 10px 0 22px;</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.62);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .home-grid{</span></p>
<p class="p1"><span class="s1">      margin: 18px auto 0;</span></p>
<p class="p1"><span class="s1">      display:grid;</span></p>
<p class="p1"><span class="s1">      grid-template-columns: repeat(2, minmax(0,1fr));</span></p>
<p class="p1"><span class="s1">      gap: 14px;</span></p>
<p class="p1"><span class="s1">      width: min(860px, 96vw);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    @media (max-width: 820px){ .home-grid{ grid-template-columns: 1fr; } }</span></p>
<p class="p1"><span class="s1">    .home-card{</span></p>
<p class="p1"><span class="s1">      text-align:left;</span></p>
<p class="p1"><span class="s1">      border-radius: 20px;</span></p>
<p class="p1"><span class="s1">      border: 1px solid rgba(255,255,255,0.55);</span></p>
<p class="p1"><span class="s1">      background:</span></p>
<p class="p1"><span class="s1">        linear-gradient(135deg, rgba(255,255,255,0.74), rgba(255,255,255,0.46));</span></p>
<p class="p1"><span class="s1">      backdrop-filter: blur(16px);</span></p>
<p class="p1"><span class="s1">      padding: 18px 16px;</span></p>
<p class="p1"><span class="s1">      cursor:pointer;</span></p>
<p class="p1"><span class="s1">      transition: transform .18s ease, border-color .18s ease, box-shadow .18s ease;</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 18px 55px rgba(58,36,48,0.12);</span></p>
<p class="p1"><span class="s1">      position: relative;</span></p>
<p class="p1"><span class="s1">      overflow:hidden;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .home-card::before{</span></p>
<p class="p1"><span class="s1">      content:"";</span></p>
<p class="p1"><span class="s1">      position:absolute; inset:-40%;</span></p>
<p class="p1"><span class="s1">      background:</span></p>
<p class="p1"><span class="s1">        radial-gradient(circle at 25% 25%, rgba(var(--gold-rgb),0.22), transparent 55%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(circle at 75% 35%, rgba(var(--rose-rgb),0.15), transparent 58%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(circle at 55% 80%, rgba(var(--green-rgb),0.10), transparent 60%);</span></p>
<p class="p1"><span class="s1">      filter: blur(22px);</span></p>
<p class="p1"><span class="s1">      opacity: 0.85;</span></p>
<p class="p1"><span class="s1">      transform: rotate(-6deg);</span></p>
<p class="p1"><span class="s1">      pointer-events:none;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .home-card:hover{</span></p>
<p class="p1"><span class="s1">      transform: translateY(-2px);</span></p>
<p class="p1"><span class="s1">      border-color: rgba(255,255,255,0.78);</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 22px 70px rgba(58,36,48,0.16);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .home-card:focus-visible{</span></p>
<p class="p1"><span class="s1">      outline: 2px solid rgba(var(--gold-rgb),0.55);</span></p>
<p class="p1"><span class="s1">      outline-offset: 5px;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .home-title{</span></p>
<p class="p1"><span class="s1">      font-family:'Playfair Display', serif;</span></p>
<p class="p1"><span class="s1">      font-size: 1.18rem;</span></p>
<p class="p1"><span class="s1">      margin: 0 0 6px;</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.92);</span></p>
<p class="p1"><span class="s1">      position: relative;</span></p>
<p class="p1"><span class="s1">      z-index: 2;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .home-desc{</span></p>
<p class="p1"><span class="s1">      margin: 0;</span></p>
<p class="p1"><span class="s1">      font-size: 0.86rem;</span></p>
<p class="p1"><span class="s1">      line-height: 1.6;</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.70);</span></p>
<p class="p1"><span class="s1">      position: relative;</span></p>
<p class="p1"><span class="s1">      z-index: 2;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .note{</span></p>
<p class="p1"><span class="s1">      font-size:0.62rem;</span></p>
<p class="p1"><span class="s1">      opacity:0.72;</span></p>
<p class="p1"><span class="s1">      letter-spacing:1px;</span></p>
<p class="p1"><span class="s1">      line-height:1.4;</span></p>
<p class="p1"><span class="s1">      margin-top: 12px;</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.62);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       ACT I BACKGROUND</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    #bgA.garden-bg{</span></p>
<p class="p1"><span class="s1">      background:</span></p>
<p class="p1"><span class="s1">        radial-gradient(980px 720px at 18% 22%, rgba(var(--gold-rgb),0.24), transparent 62%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(900px 680px at 82% 32%, rgba(var(--rose-rgb),0.20), transparent 60%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(980px 760px at 45% 95%, rgba(var(--gold-rgb),0.14), transparent 62%),</span></p>
<p class="p1"><span class="s1">        linear-gradient(135deg, #FFF6F0 0%, #FFE9E1 42%, #FFF8F4 100%);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #bgA.garden-bg::before{</span></p>
<p class="p1"><span class="s1">      content:"";</span></p>
<p class="p1"><span class="s1">      position:absolute; inset:-35%;</span></p>
<p class="p1"><span class="s1">      background:</span></p>
<p class="p1"><span class="s1">        radial-gradient(circle at 22% 28%, rgba(var(--gold-rgb),0.18), transparent 58%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(circle at 78% 44%, rgba(var(--rose-rgb),0.16), transparent 62%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(circle at 52% 74%, rgba(var(--wine2-rgb),0.10), transparent 68%),</span></p>
<p class="p1"><span class="s1">        linear-gradient(120deg,</span></p>
<p class="p1"><span class="s1">          rgba(var(--gold-rgb),0.12),</span></p>
<p class="p1"><span class="s1">          rgba(var(--wine2-rgb),0.08),</span></p>
<p class="p1"><span class="s1">          rgba(var(--rose-rgb),0.08)</span></p>
<p class="p1"><span class="s1">        );</span></p>
<p class="p1"><span class="s1">      filter: blur(22px);</span></p>
<p class="p1"><span class="s1">      opacity:0.95;</span></p>
<p class="p1"><span class="s1">      animation: drift 18s ease-in-out infinite;</span></p>
<p class="p1"><span class="s1">      transform: translate3d(0,0,0);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #bgA.garden-bg::after{</span></p>
<p class="p1"><span class="s1">      content:"";</span></p>
<p class="p1"><span class="s1">      position:absolute; inset:0;</span></p>
<p class="p1"><span class="s1">      background-image:url("https://www.transparenttextures.com/patterns/natural-paper.png");</span></p>
<p class="p1"><span class="s1">      opacity:0.20;</span></p>
<p class="p1"><span class="s1">      mix-blend-mode:overlay;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    #motesA{ z-index:2; opacity:0.95; overflow:hidden; }</span></p>
<p class="p1"><span class="s1">    .heart-mote{</span></p>
<p class="p1"><span class="s1">      position:absolute;</span></p>
<p class="p1"><span class="s1">      width:28px;</span></p>
<p class="p1"><span class="s1">      height:28px;</span></p>
<p class="p1"><span class="s1">      filter: drop-shadow(0 10px 20px rgba(58,36,48,0.10));</span></p>
<p class="p1"><span class="s1">      opacity:0;</span></p>
<p class="p1"><span class="s1">      transform: translate3d(0,0,0);</span></p>
<p class="p1"><span class="s1">      animation: heartFloat linear infinite;</span></p>
<p class="p1"><span class="s1">      will-change: transform, opacity;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .heart-mote svg{ width:100%; height:100%; display:block; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    @keyframes heartFloat{</span></p>
<p class="p1"><span class="s1">      0%{ transform: translate3d(var(--x), 112vh, 0) rotate(var(--r)) scale(var(--s)); opacity:0; }</span></p>
<p class="p1"><span class="s1">      12%{ opacity:0.70; }</span></p>
<p class="p1"><span class="s1">      88%{ opacity:0.55; }</span></p>
<p class="p1"><span class="s1">      100%{ transform: translate3d(var(--x2), -18vh, 0) rotate(calc(var(--r) + 14deg)) scale(var(--s)); opacity:0; }</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    @keyframes drift{</span></p>
<p class="p1"><span class="s1">      0%{transform:translate(-4%,-2%) rotate(-2deg);}</span></p>
<p class="p1"><span class="s1">      50%{transform:translate(4%,2%) rotate(2deg);}</span></p>
<p class="p1"><span class="s1">      100%{transform:translate(-4%,-2%) rotate(-2deg);}</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       ACT II BACKGROUND</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    #bgB.garden-bg{</span></p>
<p class="p1"><span class="s1">      background:</span></p>
<p class="p1"><span class="s1">        radial-gradient(900px 700px at 20% 20%, rgba(var(--gold-rgb),0.18), transparent 60%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(800px 650px at 80% 30%, rgba(232,213,209,0.26), transparent 55%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(900px 700px at 40% 90%, rgba(var(--green-rgb),0.10), transparent 55%),</span></p>
<p class="p1"><span class="s1">        linear-gradient(120deg, #FFFEFA 0%, #FFF7EB 55%, #FFFDF7 100%);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #bgB.garden-bg::before{</span></p>
<p class="p1"><span class="s1">      content:"";</span></p>
<p class="p1"><span class="s1">      position:absolute; inset:-40%;</span></p>
<p class="p1"><span class="s1">      background:</span></p>
<p class="p1"><span class="s1">        radial-gradient(circle at 20% 30%, rgba(255,255,255,0.70), transparent 55%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(circle at 70% 40%, rgba(255,255,255,0.45), transparent 60%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(circle at 50% 70%, rgba(255,255,255,0.35), transparent 65%),</span></p>
<p class="p1"><span class="s1">        linear-gradient(120deg, rgba(var(--gold-rgb),0.10), rgba(232,213,209,0.14), rgba(var(--green-rgb),0.08));</span></p>
<p class="p1"><span class="s1">      filter:blur(18px);</span></p>
<p class="p1"><span class="s1">      opacity:0.9;</span></p>
<p class="p1"><span class="s1">      animation:drift 18s ease-in-out infinite;</span></p>
<p class="p1"><span class="s1">      transform:translate3d(0,0,0);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #bgB.garden-bg::after{</span></p>
<p class="p1"><span class="s1">      content:"";</span></p>
<p class="p1"><span class="s1">      position:absolute; inset:0;</span></p>
<p class="p1"><span class="s1">      background-image:url("https://www.transparenttextures.com/patterns/natural-paper.png");</span></p>
<p class="p1"><span class="s1">      opacity:0.40;</span></p>
<p class="p1"><span class="s1">      mix-blend-mode:multiply;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    #petalsB{ z-index:2; overflow:hidden; }</span></p>
<p class="p1"><span class="s1">    .petal{</span></p>
<p class="p1"><span class="s1">      position:absolute;</span></p>
<p class="p1"><span class="s1">      top:-10%;</span></p>
<p class="p1"><span class="s1">      width:10px;</span></p>
<p class="p1"><span class="s1">      height:16px;</span></p>
<p class="p1"><span class="s1">      border-radius:60% 40% 60% 40%;</span></p>
<p class="p1"><span class="s1">      background:rgba(232,213,209,0.62);</span></p>
<p class="p1"><span class="s1">      box-shadow:0 0 0 1px rgba(var(--gold-rgb),0.10);</span></p>
<p class="p1"><span class="s1">      filter:blur(0.15px);</span></p>
<p class="p1"><span class="s1">      animation: fall linear infinite;</span></p>
<p class="p1"><span class="s1">      transform: rotate(12deg);</span></p>
<p class="p1"><span class="s1">      opacity:0.85;</span></p>
<p class="p1"><span class="s1">      will-change: transform, opacity;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    @keyframes fall{</span></p>
<p class="p1"><span class="s1">      0%{transform:translate3d(0,-20px,0) rotate(10deg);}</span></p>
<p class="p1"><span class="s1">      100%{transform:translate3d(0,120vh,0) rotate(260deg);}</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    #birdsB{ z-index:3; overflow:hidden; opacity:0.72; filter:blur(0.1px); }</span></p>
<p class="p1"><span class="s1">    .bird{</span></p>
<p class="p1"><span class="s1">      position:absolute;</span></p>
<p class="p1"><span class="s1">      left:0; top:0;</span></p>
<p class="p1"><span class="s1">      width:56px; height:30px;</span></p>
<p class="p1"><span class="s1">      opacity:0.60;</span></p>
<p class="p1"><span class="s1">      animation: flyDiag linear infinite;</span></p>
<p class="p1"><span class="s1">      transform:translate3d(var(--fromX),var(--fromY),0) scale(var(--s,1));</span></p>
<p class="p1"><span class="s1">      will-change:transform,opacity;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    @keyframes flyDiag{</span></p>
<p class="p1"><span class="s1">      0%{transform:translate3d(var(--fromX),var(--fromY),0) scale(var(--s,1)); opacity:0;}</span></p>
<p class="p1"><span class="s1">      10%{opacity:0.70;}</span></p>
<p class="p1"><span class="s1">      90%{opacity:0.60;}</span></p>
<p class="p1"><span class="s1">      100%{transform:translate3d(var(--toX),var(--toY),0) scale(var(--s,1)); opacity:0;}</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .bird .wing{transform-box:fill-box; transform-origin:center; animation:flap 0.35s ease-in-out infinite;}</span></p>
<p class="p1"><span class="s1">    .bird .wing.right{animation-delay:0.02s;}</span></p>
<p class="p1"><span class="s1">    @keyframes flap{</span></p>
<p class="p1"><span class="s1">      0%{transform:rotate(8deg) scaleY(1);}</span></p>
<p class="p1"><span class="s1">      50%{transform:rotate(-18deg) scaleY(0.92);}</span></p>
<p class="p1"><span class="s1">      100%{transform:rotate(8deg) scaleY(1);}</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       EXPERIENCE A</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    #expA{</span></p>
<p class="p1"><span class="s1">      --bg: transparent;</span></p>
<p class="p1"><span class="s1">      --fg: var(--ink);</span></p>
<p class="p1"><span class="s1">      color: var(--ink);</span></p>
<p class="p1"><span class="s1">      background:</span></p>
<p class="p1"><span class="s1">        radial-gradient(980px 640px at 50% 12%, rgba(var(--rose-rgb),0.38), transparent 62%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(900px 700px at 18% 28%, rgba(var(--wine2-rgb),0.30), transparent 62%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(900px 760px at 82% 30%, rgba(var(--rose-rgb),0.26), transparent 62%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(980px 860px at 50% 92%, rgba(var(--wine-rgb),0.18), transparent 68%),</span></p>
<p class="p1"><span class="s1">        linear-gradient(135deg, #FFF0F2 0%, #FFE3E8 42%, #FFF7F3 100%);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .container, #expB .container{</span></p>
<p class="p1"><span class="s1">      width:100%;</span></p>
<p class="p1"><span class="s1">      max-width:1200px;</span></p>
<p class="p1"><span class="s1">      margin: 0 auto;</span></p>
<p class="p1"><span class="s1">      text-align:center;</span></p>
<p class="p1"><span class="s1">      position: relative;</span></p>
<p class="p1"><span class="s1">      z-index: 10;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .isa-tag, #expB .isa-tag{ color: rgba(58,36,48,0.70); }</span></p>
<p class="p1"><span class="s1">    #expA h1.main-title{</span></p>
<p class="p1"><span class="s1">      text-shadow: 0 18px 50px rgba(58,36,48,0.10);</span></p>
<p class="p1"><span class="s1">      background: var(--valentine-grad);</span></p>
<p class="p1"><span class="s1">      -webkit-background-clip:text;</span></p>
<p class="p1"><span class="s1">      background-clip:text;</span></p>
<p class="p1"><span class="s1">      color: transparent;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .sub-theme{ color: rgba(58,36,48,0.62); }</span></p>
<p class="p1"><span class="s1">    #expA .opening-line{</span></p>
<p class="p1"><span class="s1">      margin: 12px auto 16px;</span></p>
<p class="p1"><span class="s1">      max-width: 760px;</span></p>
<p class="p1"><span class="s1">      font-family: 'Playfair Display', serif;</span></p>
<p class="p1"><span class="s1">      font-size: clamp(1.12rem, 3.4vw, 1.62rem);</span></p>
<p class="p1"><span class="s1">      line-height: 1.45;</span></p>
<p class="p1"><span class="s1">      font-style: italic;</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.88);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* ritual bar */</span></p>
<p class="p1"><span class="s1">    #expA .ritual-bar{</span></p>
<p class="p1"><span class="s1">      width:min(860px, 96vw);</span></p>
<p class="p1"><span class="s1">      margin: 10px auto 14px;</span></p>
<p class="p1"><span class="s1">      border:1px solid rgba(var(--gold-rgb),0.42);</span></p>
<p class="p1"><span class="s1">      border-radius: 999px;</span></p>
<p class="p1"><span class="s1">      background:</span></p>
<p class="p1"><span class="s1">        linear-gradient(135deg,</span></p>
<p class="p1"><span class="s1">          rgba(255,240,245,0.88),</span></p>
<p class="p1"><span class="s1">          rgba(255,228,232,0.62)</span></p>
<p class="p1"><span class="s1">        );</span></p>
<p class="p1"><span class="s1">      backdrop-filter: blur(14px);</span></p>
<p class="p1"><span class="s1">      padding:10px 14px;</span></p>
<p class="p1"><span class="s1">      box-sizing:border-box;</span></p>
<p class="p1"><span class="s1">      position:relative;</span></p>
<p class="p1"><span class="s1">      overflow:hidden;</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 18px 55px rgba(58,36,48,0.10);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .ritual-bar::before{</span></p>
<p class="p1"><span class="s1">      content:"";</span></p>
<p class="p1"><span class="s1">      position:absolute; inset:0;</span></p>
<p class="p1"><span class="s1">      background: linear-gradient(90deg,</span></p>
<p class="p1"><span class="s1">        rgba(var(--gold-rgb),0.16),</span></p>
<p class="p1"><span class="s1">        rgba(var(--rose-rgb),0.10),</span></p>
<p class="p1"><span class="s1">        rgba(var(--gold-rgb),0.12)</span></p>
<p class="p1"><span class="s1">      );</span></p>
<p class="p1"><span class="s1">      opacity:0.9;</span></p>
<p class="p1"><span class="s1">      pointer-events:none;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .steps{</span></p>
<p class="p1"><span class="s1">      position:relative;</span></p>
<p class="p1"><span class="s1">      display:flex;</span></p>
<p class="p1"><span class="s1">      justify-content:space-between;</span></p>
<p class="p1"><span class="s1">      gap:10px;</span></p>
<p class="p1"><span class="s1">      align-items:center;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .step{</span></p>
<p class="p1"><span class="s1">      display:flex; gap:8px; align-items:center;</span></p>
<p class="p1"><span class="s1">      opacity:0.55;</span></p>
<p class="p1"><span class="s1">      transition: opacity .25s ease;</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.78);</span></p>
<p class="p1"><span class="s1">      min-width:0;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .step.active{ opacity:1; }</span></p>
<p class="p1"><span class="s1">    #expA .step-dot{</span></p>
<p class="p1"><span class="s1">      width:10px; height:10px; border-radius:999px;</span></p>
<p class="p1"><span class="s1">      border:1px solid rgba(var(--gold-rgb),0.55);</span></p>
<p class="p1"><span class="s1">      background: rgba(var(--gold-rgb),0.14);</span></p>
<p class="p1"><span class="s1">      flex:0 0 auto;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .step.active .step-dot{</span></p>
<p class="p1"><span class="s1">      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.45), rgba(var(--gold-rgb),0.98) 60%, rgba(var(--rose-rgb),0.65) 100%);</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 0 0 4px rgba(var(--gold-rgb),0.10);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .step-label{</span></p>
<p class="p1"><span class="s1">      font-size:0.58rem;</span></p>
<p class="p1"><span class="s1">      letter-spacing:2px;</span></p>
<p class="p1"><span class="s1">      text-transform:uppercase;</span></p>
<p class="p1"><span class="s1">      white-space:nowrap;</span></p>
<p class="p1"><span class="s1">      overflow:hidden;</span></p>
<p class="p1"><span class="s1">      text-overflow:ellipsis;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    #expA .token-top{</span></p>
<p class="p1"><span class="s1">      width:min(980px, 96vw);</span></p>
<p class="p1"><span class="s1">      margin: 0 auto 10px;</span></p>
<p class="p1"><span class="s1">      display:flex;</span></p>
<p class="p1"><span class="s1">      justify-content:center;</span></p>
<p class="p1"><span class="s1">      gap:10px;</span></p>
<p class="p1"><span class="s1">      flex-wrap:wrap;</span></p>
<p class="p1"><span class="s1">      align-items:center;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .token-badge{</span></p>
<p class="p1"><span class="s1">      display:inline-flex; align-items:center; gap:10px;</span></p>
<p class="p1"><span class="s1">      padding:10px 14px;</span></p>
<p class="p1"><span class="s1">      border:1px solid rgba(var(--gold-rgb),0.30);</span></p>
<p class="p1"><span class="s1">      border-radius:999px;</span></p>
<p class="p1"><span class="s1">      background: linear-gradient(135deg, rgba(255,255,255,0.64), rgba(255,255,255,0.40));</span></p>
<p class="p1"><span class="s1">      backdrop-filter: blur(14px);</span></p>
<p class="p1"><span class="s1">      letter-spacing:2px;</span></p>
<p class="p1"><span class="s1">      text-transform:uppercase;</span></p>
<p class="p1"><span class="s1">      font-size:0.62rem;</span></p>
<p class="p1"><span class="s1">      opacity:0.98;</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.80);</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 18px 55px rgba(58,36,48,0.08);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .token-dots{ display:inline-flex; gap:6px; }</span></p>
<p class="p1"><span class="s1">    #expA .dot{</span></p>
<p class="p1"><span class="s1">      width:10px; height:10px;</span></p>
<p class="p1"><span class="s1">      border-radius:999px;</span></p>
<p class="p1"><span class="s1">      border:1px solid rgba(var(--gold-rgb),0.55);</span></p>
<p class="p1"><span class="s1">      background: rgba(var(--gold-rgb),0.10);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .dot.filled{</span></p>
<p class="p1"><span class="s1">      background: rgba(var(--gold-rgb),0.95);</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 0 0 4px rgba(var(--gold-rgb),0.10);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    #expA .trait-grid{</span></p>
<p class="p1"><span class="s1">      width: min(980px, 96vw);</span></p>
<p class="p1"><span class="s1">      margin: 0 auto;</span></p>
<p class="p1"><span class="s1">      display:grid;</span></p>
<p class="p1"><span class="s1">      grid-template-columns: repeat(4, minmax(0, 1fr));</span></p>
<p class="p1"><span class="s1">      gap:10px;</span></p>
<p class="p1"><span class="s1">      padding:10px;</span></p>
<p class="p1"><span class="s1">      box-sizing:border-box;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    @media (max-width: 900px){ #expA .trait-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    #expA .trait{</span></p>
<p class="p1"><span class="s1">      border-radius:16px;</span></p>
<p class="p1"><span class="s1">      border:1px solid rgba(var(--gold-rgb),0.22);</span></p>
<p class="p1"><span class="s1">      background: linear-gradient(135deg, rgba(255,255,255,0.70), rgba(255,255,255,0.44));</span></p>
<p class="p1"><span class="s1">      backdrop-filter: blur(14px);</span></p>
<p class="p1"><span class="s1">      padding:14px 14px 12px;</span></p>
<p class="p1"><span class="s1">      text-align:left;</span></p>
<p class="p1"><span class="s1">      cursor:pointer;</span></p>
<p class="p1"><span class="s1">      transition: transform .18s ease, border-color .18s ease, box-shadow .18s ease;</span></p>
<p class="p1"><span class="s1">      position:relative;</span></p>
<p class="p1"><span class="s1">      overflow:hidden;</span></p>
<p class="p1"><span class="s1">      min-height: 110px;</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.92);</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 18px 55px rgba(58,36,48,0.10);</span></p>
<p class="p1"><span class="s1">      user-select:none;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .trait::before{</span></p>
<p class="p1"><span class="s1">      content:"";</span></p>
<p class="p1"><span class="s1">      position:absolute; inset:-45%;</span></p>
<p class="p1"><span class="s1">      background:</span></p>
<p class="p1"><span class="s1">        radial-gradient(circle at 25% 30%, rgba(var(--gold-rgb),0.16), transparent 58%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(circle at 70% 40%, rgba(var(--rose-rgb),0.12), transparent 62%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(circle at 55% 80%, rgba(var(--wine2-rgb),0.08), transparent 68%);</span></p>
<p class="p1"><span class="s1">      filter: blur(22px);</span></p>
<p class="p1"><span class="s1">      opacity:0.8;</span></p>
<p class="p1"><span class="s1">      transform: rotate(-6deg);</span></p>
<p class="p1"><span class="s1">      pointer-events:none;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .trait:hover{</span></p>
<p class="p1"><span class="s1">      border-color: rgba(var(--gold-rgb),0.42);</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 22px 70px rgba(58,36,48,0.14);</span></p>
<p class="p1"><span class="s1">      transform: translateY(-1px);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .trait:focus-visible{</span></p>
<p class="p1"><span class="s1">      outline: 2px solid rgba(var(--gold-rgb),0.55);</span></p>
<p class="p1"><span class="s1">      outline-offset: 4px;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .trait-title{</span></p>
<p class="p1"><span class="s1">      font-family:'Playfair Display', serif;</span></p>
<p class="p1"><span class="s1">      font-size:1.02rem;</span></p>
<p class="p1"><span class="s1">      line-height:1.22;</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.94);</span></p>
<p class="p1"><span class="s1">      position: relative;</span></p>
<p class="p1"><span class="s1">      z-index:2;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .trait-sub{</span></p>
<p class="p1"><span class="s1">      margin-top:6px;</span></p>
<p class="p1"><span class="s1">      font-size:0.62rem;</span></p>
<p class="p1"><span class="s1">      letter-spacing:2px;</span></p>
<p class="p1"><span class="s1">      text-transform:uppercase;</span></p>
<p class="p1"><span class="s1">      opacity:0.76;</span></p>
<p class="p1"><span class="s1">      line-height:1.35;</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.70);</span></p>
<p class="p1"><span class="s1">      position: relative;</span></p>
<p class="p1"><span class="s1">      z-index:2;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .trait-meter{</span></p>
<p class="p1"><span class="s1">      margin-top:10px;</span></p>
<p class="p1"><span class="s1">      display:flex;</span></p>
<p class="p1"><span class="s1">      justify-content:space-between;</span></p>
<p class="p1"><span class="s1">      align-items:center;</span></p>
<p class="p1"><span class="s1">      gap:10px;</span></p>
<p class="p1"><span class="s1">      position: relative;</span></p>
<p class="p1"><span class="s1">      z-index:2;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .trait-meter-label{</span></p>
<p class="p1"><span class="s1">      font-size:0.52rem;</span></p>
<p class="p1"><span class="s1">      letter-spacing:2px;</span></p>
<p class="p1"><span class="s1">      text-transform:uppercase;</span></p>
<p class="p1"><span class="s1">      opacity:0.72;</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.64);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .token-slots{ display:inline-flex; gap:8px; align-items:center; }</span></p>
<p class="p1"><span class="s1">    #expA .slot{</span></p>
<p class="p1"><span class="s1">      width:14px; height:14px;</span></p>
<p class="p1"><span class="s1">      border-radius:999px;</span></p>
<p class="p1"><span class="s1">      border:1px solid rgba(var(--gold-rgb),0.55);</span></p>
<p class="p1"><span class="s1">      background: rgba(var(--gold-rgb),0.10);</span></p>
<p class="p1"><span class="s1">      position:relative;</span></p>
<p class="p1"><span class="s1">      overflow:hidden;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .slot.on{</span></p>
<p class="p1"><span class="s1">      background: radial-gradient(circle at 30% 30%,</span></p>
<p class="p1"><span class="s1">        rgba(255,255,255,0.35),</span></p>
<p class="p1"><span class="s1">        rgba(var(--gold-rgb),0.95) 55%,</span></p>
<p class="p1"><span class="s1">        rgba(var(--rose-rgb),0.70) 100%);</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 0 0 4px rgba(var(--gold-rgb),0.10);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* Receipt title must match main title exactly (Act A) */</span></p>
<p class="p1"><span class="s1">    #expA #a-capture-frame h2{</span></p>
<p class="p1"><span class="s1">      background: var(--valentine-grad) !important;</span></p>
<p class="p1"><span class="s1">      -webkit-background-clip:text !important;</span></p>
<p class="p1"><span class="s1">      background-clip:text !important;</span></p>
<p class="p1"><span class="s1">      color: transparent !important;</span></p>
<p class="p1"><span class="s1">      text-shadow: 0 18px 50px rgba(58,36,48,0.10) !important;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    #expA .btn, #expB .btn{</span></p>
<p class="p1"><span class="s1">      border:1px solid rgba(var(--gold-rgb),0.28);</span></p>
<p class="p1"><span class="s1">      padding:10px 18px;</span></p>
<p class="p1"><span class="s1">      font-family:'Lato', sans-serif;</span></p>
<p class="p1"><span class="s1">      text-transform:uppercase;</span></p>
<p class="p1"><span class="s1">      letter-spacing:2px;</span></p>
<p class="p1"><span class="s1">      font-size:0.7rem;</span></p>
<p class="p1"><span class="s1">      cursor:pointer;</span></p>
<p class="p1"><span class="s1">      transition:0.3s;</span></p>
<p class="p1"><span class="s1">      min-width: 150px;</span></p>
<p class="p1"><span class="s1">      border-radius: 14px;</span></p>
<p class="p1"><span class="s1">      background: linear-gradient(135deg, rgba(255,255,255,0.70), rgba(255,255,255,0.44));</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.86);</span></p>
<p class="p1"><span class="s1">      backdrop-filter: blur(14px);</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 18px 55px rgba(58,36,48,0.10);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .btn:hover, #expB .btn:hover{</span></p>
<p class="p1"><span class="s1">      transform: translateY(-1px);</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 22px 70px rgba(58,36,48,0.14);</span></p>
<p class="p1"><span class="s1">      border-color: rgba(var(--gold-rgb),0.44);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .btn:focus-visible, #expB .btn:focus-visible{</span></p>
<p class="p1"><span class="s1">      outline: 2px solid rgba(var(--gold-rgb),0.55);</span></p>
<p class="p1"><span class="s1">      outline-offset: 4px;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .btn-save, #expB .btn-save{</span></p>
<p class="p1"><span class="s1">      background: linear-gradient(135deg, rgba(var(--gold-rgb),0.95), rgba(var(--old-gold),0.90));</span></p>
<p class="p1"><span class="s1">      border-color: rgba(var(--gold-rgb),0.75);</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.90);</span></p>
<p class="p1"><span class="s1">      font-weight: 800;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .btn:disabled, #expB .btn:disabled{ opacity:0.5; cursor:not-allowed; transform:none; }</span></p>
<p class="p1"><span class="s1">    #expA .btn-sound.active, #expB .btn-sound.active{</span></p>
<p class="p1"><span class="s1">      border-color: rgba(var(--gold-rgb),0.70);</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 18px 55px rgba(var(--gold-rgb),0.12);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .tiny-note{</span></p>
<p class="p1"><span class="s1">      font-size:0.62rem;</span></p>
<p class="p1"><span class="s1">      opacity:0.70;</span></p>
<p class="p1"><span class="s1">      letter-spacing:1px;</span></p>
<p class="p1"><span class="s1">      margin-top:10px;</span></p>
<p class="p1"><span class="s1">      line-height:1.35;</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.64);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    #expA .panel{</span></p>
<p class="p1"><span class="s1">      width: min(820px, 94vw);</span></p>
<p class="p1"><span class="s1">      margin: 0 auto;</span></p>
<p class="p1"><span class="s1">      border: 1px solid rgba(var(--gold-rgb),0.26);</span></p>
<p class="p1"><span class="s1">      border-radius: 18px;</span></p>
<p class="p1"><span class="s1">      background: linear-gradient(135deg, rgba(255,255,255,0.70), rgba(255,255,255,0.44));</span></p>
<p class="p1"><span class="s1">      backdrop-filter: blur(14px);</span></p>
<p class="p1"><span class="s1">      padding: 18px 16px;</span></p>
<p class="p1"><span class="s1">      box-sizing: border-box;</span></p>
<p class="p1"><span class="s1">      position: relative;</span></p>
<p class="p1"><span class="s1">      overflow: hidden;</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 22px 70px rgba(58,36,48,0.12);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .recognition-line{</span></p>
<p class="p1"><span class="s1">      font-family: 'Playfair Display', serif;</span></p>
<p class="p1"><span class="s1">      font-size: clamp(1.1rem, 3.4vw, 1.7rem);</span></p>
<p class="p1"><span class="s1">      line-height: 1.4;</span></p>
<p class="p1"><span class="s1">      font-style: italic;</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.92);</span></p>
<p class="p1"><span class="s1">      margin: 10px 0 10px;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    #expA #a-result-screen{ display:none; opacity:0; transition: opacity .35s ease; }</span></p>
<p class="p1"><span class="s1">    #expA #a-capture-frame{</span></p>
<p class="p1"><span class="s1">      background: rgba(255,255,255,0.78);</span></p>
<p class="p1"><span class="s1">      padding: clamp(28px, 5vw, 56px) clamp(18px, 4vw, 38px);</span></p>
<p class="p1"><span class="s1">      width: 92vw;</span></p>
<p class="p1"><span class="s1">      max-width: 560px;</span></p>
<p class="p1"><span class="s1">      margin: 0 auto;</span></p>
<p class="p1"><span class="s1">      position: relative;</span></p>
<p class="p1"><span class="s1">      box-sizing: border-box;</span></p>
<p class="p1"><span class="s1">      border: 1px solid rgba(var(--gold-rgb),0.22);</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 30px 70px rgba(58,36,48,0.12);</span></p>
<p class="p1"><span class="s1">      background-image:</span></p>
<p class="p1"><span class="s1">        radial-gradient(900px 520px at 12% 12%, rgba(var(--gold-rgb),0.14), transparent 60%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(800px 520px at 85% 30%, rgba(var(--rose-rgb),0.10), transparent 62%),</span></p>
<p class="p1"><span class="s1">        url("https://www.transparenttextures.com/patterns/paper-fibers.png");</span></p>
<p class="p1"><span class="s1">      background-blend-mode: screen, screen, normal;</span></p>
<p class="p1"><span class="s1">      border-radius: 18px;</span></p>
<p class="p1"><span class="s1">      overflow:hidden;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA #a-capture-frame::before{</span></p>
<p class="p1"><span class="s1">      content:"";</span></p>
<p class="p1"><span class="s1">      position:absolute;</span></p>
<p class="p1"><span class="s1">      inset: 15px;</span></p>
<p class="p1"><span class="s1">      border: 0.8px solid rgba(var(--gold-rgb),0.50);</span></p>
<p class="p1"><span class="s1">      pointer-events:none;</span></p>
<p class="p1"><span class="s1">      border-radius: 14px;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .pill-row{</span></p>
<p class="p1"><span class="s1">      display:flex;</span></p>
<p class="p1"><span class="s1">      gap:8px;</span></p>
<p class="p1"><span class="s1">      flex-wrap:wrap;</span></p>
<p class="p1"><span class="s1">      justify-content:center;</span></p>
<p class="p1"><span class="s1">      margin-top: 10px;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expA .pill{</span></p>
<p class="p1"><span class="s1">      font-size:0.55rem;</span></p>
<p class="p1"><span class="s1">      letter-spacing:2px;</span></p>
<p class="p1"><span class="s1">      text-transform:uppercase;</span></p>
<p class="p1"><span class="s1">      padding: 8px 10px;</span></p>
<p class="p1"><span class="s1">      border: 1px solid rgba(var(--gold-rgb),0.40);</span></p>
<p class="p1"><span class="s1">      border-radius: 999px;</span></p>
<p class="p1"><span class="s1">      background: rgba(255,255,255,0.55);</span></p>
<p class="p1"><span class="s1">      color: rgba(58,36,48,0.78);</span></p>
<p class="p1"><span class="s1">      backdrop-filter: blur(10px);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       EXPERIENCE B</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    #expB{</span></p>
<p class="p1"><span class="s1">      --bg: var(--porcelain);</span></p>
<p class="p1"><span class="s1">      --fg: var(--deep-green);</span></p>
<p class="p1"><span class="s1">      color: var(--deep-green);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expB .sub-theme{ color: rgba(var(--green-rgb),0.70); }</span></p>
<p class="p1"><span class="s1">    #expB h1.main-title{</span></p>
<p class="p1"><span class="s1">      text-shadow:none;</span></p>
<p class="p1"><span class="s1">      background: linear-gradient(135deg, rgba(var(--green-rgb),0.95), rgba(var(--gold-rgb),0.90));</span></p>
<p class="p1"><span class="s1">      -webkit-background-clip:text; background-clip:text; color:transparent;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expB .deck-area{</span></p>
<p class="p1"><span class="s1">      position:relative;</span></p>
<p class="p1"><span class="s1">      height:clamp(260px,40vh,420px);</span></p>
<p class="p1"><span class="s1">      width:100%;</span></p>
<p class="p1"><span class="s1">      display:flex;</span></p>
<p class="p1"><span class="s1">      justify-content:center;</span></p>
<p class="p1"><span class="s1">      align-items:center;</span></p>
<p class="p1"><span class="s1">      perspective:1000px;</span></p>
<p class="p1"><span class="s1">      margin-top: 10px;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expB .card{</span></p>
<p class="p1"><span class="s1">      position:absolute;</span></p>
<p class="p1"><span class="s1">      width:clamp(120px,25vw,180px);</span></p>
<p class="p1"><span class="s1">      height:clamp(170px,35vh,260px);</span></p>
<p class="p1"><span class="s1">      border-radius:14px;</span></p>
<p class="p1"><span class="s1">      cursor:pointer;</span></p>
<p class="p1"><span class="s1">      transition:all 0.8s cubic-bezier(0.2,1,0.3,1);</span></p>
<p class="p1"><span class="s1">      overflow:hidden;</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 18px 55px rgba(58,36,48,0.10);</span></p>
<p class="p1"><span class="s1">      border: 1px solid rgba(var(--gold-rgb),0.22);</span></p>
<p class="p1"><span class="s1">      background: linear-gradient(135deg, rgba(255,255,255,0.80), rgba(255,255,255,0.50));</span></p>
<p class="p1"><span class="s1">      backdrop-filter: blur(10px);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expB .card::after{</span></p>
<p class="p1"><span class="s1">      content:'';</span></p>
<p class="p1"><span class="s1">      position:absolute;</span></p>
<p class="p1"><span class="s1">      inset:10px;</span></p>
<p class="p1"><span class="s1">      border-radius:12px;</span></p>
<p class="p1"><span class="s1">      border:1px solid rgba(var(--gold-rgb),0.55);</span></p>
<p class="p1"><span class="s1">      background:</span></p>
<p class="p1"><span class="s1">        radial-gradient(800px 520px at 20% 18%, rgba(var(--gold-rgb),0.12), transparent 60%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(760px 560px at 75% 30%, rgba(232,213,209,0.18), transparent 60%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(760px 620px at 45% 90%, rgba(var(--green-rgb),0.08), transparent 62%),</span></p>
<p class="p1"><span class="s1">        url("https://www.transparenttextures.com/patterns/paper-fibers.png");</span></p>
<p class="p1"><span class="s1">      background-blend-mode: screen, screen, screen, normal;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expB .card-crest{</span></p>
<p class="p1"><span class="s1">      position:absolute;</span></p>
<p class="p1"><span class="s1">      top:50%;</span></p>
<p class="p1"><span class="s1">      left:50%;</span></p>
<p class="p1"><span class="s1">      transform:translate(-50%,-50%);</span></p>
<p class="p1"><span class="s1">      color: rgba(var(--gold-rgb),0.85);</span></p>
<p class="p1"><span class="s1">      font-family:'Playfair Display',serif;</span></p>
<p class="p1"><span class="s1">      font-size:2.2rem;</span></p>
<p class="p1"><span class="s1">      z-index:2;</span></p>
<p class="p1"><span class="s1">      opacity:0.75;</span></p>
<p class="p1"><span class="s1">      pointer-events:none;</span></p>
<p class="p1"><span class="s1">      text-shadow: 0 18px 40px rgba(58,36,48,0.10);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    #expB #b-result-screen{ display:none; opacity:0; transition:opacity .6s ease;}</span></p>
<p class="p1"><span class="s1">    #expB #b-capture-frame{</span></p>
<p class="p1"><span class="s1">      background: rgba(255,255,255,0.82);</span></p>
<p class="p1"><span class="s1">      padding:clamp(26px,4.5vw,56px) clamp(18px,4vw,40px);</span></p>
<p class="p1"><span class="s1">      width:min(92vw, 460px);</span></p>
<p class="p1"><span class="s1">      margin:0 auto;</span></p>
<p class="p1"><span class="s1">      position:relative;</span></p>
<p class="p1"><span class="s1">      box-sizing:border-box;</span></p>
<p class="p1"><span class="s1">      border:1px solid rgba(var(--gold-rgb),0.22);</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 30px 70px rgba(58,36,48,0.10);</span></p>
<p class="p1"><span class="s1">      background-image:url("https://www.transparenttextures.com/patterns/paper-fibers.png");</span></p>
<p class="p1"><span class="s1">      border-radius: 18px;</span></p>
<p class="p1"><span class="s1">      overflow:hidden;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expB #b-capture-frame::before{</span></p>
<p class="p1"><span class="s1">      content:"";</span></p>
<p class="p1"><span class="s1">      position:absolute;</span></p>
<p class="p1"><span class="s1">      inset:14px;</span></p>
<p class="p1"><span class="s1">      border:0.8px solid rgba(var(--gold-rgb),0.60);</span></p>
<p class="p1"><span class="s1">      pointer-events:none;</span></p>
<p class="p1"><span class="s1">      border-radius: 14px;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    #expB .card-canvas{</span></p>
<p class="p1"><span class="s1">      position:relative;</span></p>
<p class="p1"><span class="s1">      width:100%;</span></p>
<p class="p1"><span class="s1">      margin:16px auto 10px;</span></p>
<p class="p1"><span class="s1">      overflow:hidden;</span></p>
<p class="p1"><span class="s1">      background:rgba(255,255,255,0.65);</span></p>
<p class="p1"><span class="s1">      aspect-ratio: 4 / 5;</span></p>
<p class="p1"><span class="s1">      max-height: 52vh;</span></p>
<p class="p1"><span class="s1">      touch-action:none;</span></p>
<p class="p1"><span class="s1">      border-radius: 14px;</span></p>
<p class="p1"><span class="s1">      border: 1px solid rgba(var(--gold-rgb),0.18);</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 18px 55px rgba(58,36,48,0.08);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expB .photo-frame{</span></p>
<p class="p1"><span class="s1">      position:absolute;</span></p>
<p class="p1"><span class="s1">      left:7.5%;</span></p>
<p class="p1"><span class="s1">      right:7.5%;</span></p>
<p class="p1"><span class="s1">      top:10%;</span></p>
<p class="p1"><span class="s1">      height:46%;</span></p>
<p class="p1"><span class="s1">      border-radius:12px;</span></p>
<p class="p1"><span class="s1">      overflow:hidden;</span></p>
<p class="p1"><span class="s1">      border:1px solid rgba(var(--gold-rgb),0.22);</span></p>
<p class="p1"><span class="s1">      background:rgba(255,255,255,0.78);</span></p>
<p class="p1"><span class="s1">      box-shadow:0 10px 22px rgba(58,36,48,0.08);</span></p>
<p class="p1"><span class="s1">      display:none;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expB .photo-frame img{</span></p>
<p class="p1"><span class="s1">      width:100%;</span></p>
<p class="p1"><span class="s1">      height:100%;</span></p>
<p class="p1"><span class="s1">      object-fit:cover;</span></p>
<p class="p1"><span class="s1">      display:block;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expB .card-canvas[data-mode="hybrid"] .photo-frame{ display:block; }</span></p>
<p class="p1"><span class="s1">    #expB .card-canvas[data-mode="decor"] .photo-frame{ display:none !important; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    #expB .card-canvas::after{</span></p>
<p class="p1"><span class="s1">      content:"";</span></p>
<p class="p1"><span class="s1">      position:absolute; inset:-40%;</span></p>
<p class="p1"><span class="s1">      background:</span></p>
<p class="p1"><span class="s1">        radial-gradient(circle at 20% 25%, rgba(255,255,255,0.55), transparent 58%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(circle at 70% 40%, rgba(var(--gold-rgb),0.16), transparent 62%),</span></p>
<p class="p1"><span class="s1">        radial-gradient(circle at 45% 80%, rgba(232,213,209,0.20), transparent 62%);</span></p>
<p class="p1"><span class="s1">      filter: blur(18px);</span></p>
<p class="p1"><span class="s1">      opacity: var(--shimmer, 0.10);</span></p>
<p class="p1"><span class="s1">      animation: drift 16s ease-in-out infinite;</span></p>
<p class="p1"><span class="s1">      pointer-events:none;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    #expB .decor-layer{ position:absolute; inset:0; pointer-events:auto; z-index:3; }</span></p>
<p class="p1"><span class="s1">    #expB .sticker{</span></p>
<p class="p1"><span class="s1">      position:absolute;</span></p>
<p class="p1"><span class="s1">      left:50%; top:50%;</span></p>
<p class="p1"><span class="s1">      transform: translate(-50%,-50%) rotate(0deg) scale(1);</span></p>
<p class="p1"><span class="s1">      transform-origin: center;</span></p>
<p class="p1"><span class="s1">      user-select:none;</span></p>
<p class="p1"><span class="s1">      touch-action:none;</span></p>
<p class="p1"><span class="s1">      filter:drop-shadow(0 10px 16px rgba(58,36,48,0.12));</span></p>
<p class="p1"><span class="s1">      cursor:grab;</span></p>
<p class="p1"><span class="s1">      z-index:4;</span></p>
<p class="p1"><span class="s1">      will-change: transform, left, top;</span></p>
<p class="p1"><span class="s1">      font-family: "Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji","Twemoji Mozilla",system-ui,sans-serif;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expB .sticker:active{ cursor:grabbing; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    #expB .decorate-panel{</span></p>
<p class="p1"><span class="s1">      margin-top:14px;</span></p>
<p class="p1"><span class="s1">      display:grid;</span></p>
<p class="p1"><span class="s1">      gap:10px;</span></p>
<p class="p1"><span class="s1">      justify-items:center;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expB .decorate-row{</span></p>
<p class="p1"><span class="s1">      display:flex;</span></p>
<p class="p1"><span class="s1">      gap:10px;</span></p>
<p class="p1"><span class="s1">      flex-wrap:wrap;</span></p>
<p class="p1"><span class="s1">      justify-content:center;</span></p>
<p class="p1"><span class="s1">      align-items:center;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expB .pill{</span></p>
<p class="p1"><span class="s1">      border:1px solid rgba(var(--gold-rgb),0.42);</span></p>
<p class="p1"><span class="s1">      background: linear-gradient(135deg, rgba(255,255,255,0.74), rgba(255,255,255,0.46));</span></p>
<p class="p1"><span class="s1">      backdrop-filter:blur(12px);</span></p>
<p class="p1"><span class="s1">      border-radius:999px;</span></p>
<p class="p1"><span class="s1">      padding:8px 12px;</span></p>
<p class="p1"><span class="s1">      font-size:0.7rem;</span></p>
<p class="p1"><span class="s1">      letter-spacing:1px;</span></p>
<p class="p1"><span class="s1">      display:inline-flex;</span></p>
<p class="p1"><span class="s1">      align-items:center;</span></p>
<p class="p1"><span class="s1">      gap:8px;</span></p>
<p class="p1"><span class="s1">      max-width:92vw;</span></p>
<p class="p1"><span class="s1">      color: rgba(var(--green-rgb),0.86);</span></p>
<p class="p1"><span class="s1">      box-shadow: 0 18px 55px rgba(58,36,48,0.08);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expB .pill input[type="file"]{font-size:0.65rem; max-width:44vw;}</span></p>
<p class="p1"><span class="s1">    #expB .pill input[type="range"]{width:140px; max-width:40vw;}</span></p>
<p class="p1"><span class="s1">    #expB select{font:inherit;}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    #b-caption{</span></p>
<p class="p1"><span class="s1">      margin-top: 10px;</span></p>
<p class="p1"><span class="s1">      font-size: 0.66rem;</span></p>
<p class="p1"><span class="s1">      letter-spacing: 1.8px;</span></p>
<p class="p1"><span class="s1">      text-transform: uppercase;</span></p>
<p class="p1"><span class="s1">      opacity: 0.72;</span></p>
<p class="p1"><span class="s1">      line-height: 1.35;</span></p>
<p class="p1"><span class="s1">      color: rgba(var(--green-rgb),0.72);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       SEAL STYLES</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    .seal-a{</span></p>
<p class="p1"><span class="s1">      display:block;</span></p>
<p class="p1"><span class="s1">      margin: 10px auto 14px;</span></p>
<p class="p1"><span class="s1">      text-align:center;</span></p>
<p class="p1"><span class="s1">      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;</span></p>
<p class="p1"><span class="s1">      font-size: 0.62rem;</span></p>
<p class="p1"><span class="s1">      letter-spacing: 3.2px;</span></p>
<p class="p1"><span class="s1">      text-transform: uppercase;</span></p>
<p class="p1"><span class="s1">      color: rgba(var(--rose-rgb),0.82);</span></p>
<p class="p1"><span class="s1">      opacity: 0.95;</span></p>
<p class="p1"><span class="s1">      padding: 6px 10px;</span></p>
<p class="p1"><span class="s1">      width: fit-content;</span></p>
<p class="p1"><span class="s1">      border-radius: 10px;</span></p>
<p class="p1"><span class="s1">      border: 1px solid rgba(var(--rose-rgb),0.22);</span></p>
<p class="p1"><span class="s1">      background: rgba(255,255,255,0.50);</span></p>
<p class="p1"><span class="s1">      backdrop-filter: blur(10px);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    .seal-b{</span></p>
<p class="p1"><span class="s1">      display:block;</span></p>
<p class="p1"><span class="s1">      margin: 10px auto 14px;</span></p>
<p class="p1"><span class="s1">      text-align:center;</span></p>
<p class="p1"><span class="s1">      font-family: 'Playfair Display', serif;</span></p>
<p class="p1"><span class="s1">      font-style: italic;</span></p>
<p class="p1"><span class="s1">      font-size: 0.62rem;</span></p>
<p class="p1"><span class="s1">      letter-spacing: 2.2px;</span></p>
<p class="p1"><span class="s1">      text-transform: uppercase;</span></p>
<p class="p1"><span class="s1">      color: rgba(var(--gold-rgb),0.72);</span></p>
<p class="p1"><span class="s1">      opacity: 0.86;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    #expB .tiny-note{</span></p>
<p class="p1"><span class="s1">        font-family:'Lato', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;</span></p>
<p class="p1"><span class="s1">        font-size: 11.5px;</span></p>
<p class="p1"><span class="s1">        line-height: 1.55;</span></p>
<p class="p1"><span class="s1">        opacity: 0.72;</span></p>
<p class="p1"><span class="s1">        text-align: center;</span></p>
<p class="p1"><span class="s1">        letter-spacing: 0.3px;</span></p>
<p class="p1"><span class="s1">        margin-top: 10px;</span></p>
<p class="p1"><span class="s1">        max-width: 420px;</span></p>
<p class="p1"><span class="s1">        margin-left: auto;</span></p>
<p class="p1"><span class="s1">        margin-right: auto;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">  &lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;body&gt;</span></p>
<p class="p1"><span class="s1">  &lt;!-- BACKGROUND LAYERS --&gt;</span></p>
<p class="p1"><span class="s1">  &lt;div id="bgA" class="layer garden-bg"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">  &lt;div id="motesA" class="layer"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">  &lt;div id="bgB" class="layer garden-bg"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">  &lt;div id="petalsB" class="layer"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">  &lt;div id="birdsB" class="layer"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">  &lt;div class="vignette" id="vignette"&gt;&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">  &lt;div id="app"&gt;</span></p>
<p class="p1"><span class="s1">    &lt;!-- HOME --&gt;</span></p>
<p class="p1"><span class="s1">    &lt;section id="home" class="view active"&gt;</span></p>
<p class="p1"><span class="s1">      &lt;div class="home-wrap"&gt;</span></p>
<p class="p1"><span class="s1">        &lt;p class="isa-tag"&gt;ISA Chulalongkorn Presents&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">        &lt;h1 class="main-title"&gt;Heart to Heart&lt;/h1&gt;</span></p>
<p class="p1"><span class="s1">        &lt;p class="sub-theme"&gt;one heart reads into the next.&lt;/p&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        &lt;div class="home-grid"&gt;</span></p>
<p class="p1"><span class="s1">          &lt;div class="home-card" id="goA" role="button" tabindex="0" aria-label="Enter On One’s Heart"&gt;</span></p>
<p class="p1"><span class="s1">            &lt;p class="home-title"&gt;On One’s Heart&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">            &lt;p class="home-desc"&gt;Spend 3 tokens on traits → receive a mirror of your essence and counsel.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">          &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">          &lt;div class="home-card" id="goB" role="button" tabindex="0" aria-label="Enter The Secret Garden"&gt;</span></p>
<p class="p1"><span class="s1">            &lt;p class="home-title"&gt;The Secret Garden&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">            &lt;p class="home-desc"&gt;</span></p>
<p class="p1"><span class="s1">              Shuffle with intentions → draw a card → receive a quote, a book and a movie recommendation,</span></p>
<p class="p1"><span class="s1">              decorate your card, and optionally add a photo.</span></p>
<p class="p1"><span class="s1">            &lt;/p&gt;</span></p>
<p class="p1"><span class="s1">          &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">        &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        &lt;p class="note"&gt;Tip: Sound begins on first tap/click. One toggle controls both rituals.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">      &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">    &lt;/section&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    &lt;!-- EXPERIENCE A --&gt;</span></p>
<p class="p1"><span class="s1">    &lt;section id="expA" class="view"&gt;</span></p>
<p class="p1"><span class="s1">      &lt;div class="topbar"&gt;</span></p>
<p class="p1"><span class="s1">        &lt;button class="navbtn" id="a-home" type="button"&gt;← Menu&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">      &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      &lt;div class="container"&gt;</span></p>
<p class="p1"><span class="s1">        &lt;p class="isa-tag"&gt;ISA Chulalongkorn Presents&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">        &lt;h1 class="main-title"&gt;Heart to Heart&lt;/h1&gt;</span></p>
<p class="p1"><span class="s1">        &lt;p class="sub-theme"&gt;You’re not bad at love.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">        &lt;p class="opening-line"&gt;Love is learned.&lt;/p&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        &lt;div class="ritual-bar" aria-label="Ritual progress"&gt;</span></p>
<p class="p1"><span class="s1">          &lt;div class="steps"&gt;</span></p>
<p class="p1"><span class="s1">            &lt;div class="step active" id="a-stepToken"&gt;&lt;span class="step-dot"&gt;&lt;/span&gt;&lt;span class="step-label"&gt;Tokens&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">            &lt;div class="step" id="a-stepRecognize"&gt;&lt;span class="step-dot"&gt;&lt;/span&gt;&lt;span class="step-label"&gt;Recognition&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">            &lt;div class="step" id="a-stepArticulate"&gt;&lt;span class="step-dot"&gt;&lt;/span&gt;&lt;span class="step-label"&gt;Articulation&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">            &lt;div class="step" id="a-stepCounsel"&gt;&lt;span class="step-dot"&gt;&lt;/span&gt;&lt;span class="step-label"&gt;Counsel&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">          &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">        &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        &lt;!-- TOKEN SCREEN --&gt;</span></p>
<p class="p1"><span class="s1">        &lt;div id="a-token-screen"&gt;</span></p>
<p class="p1"><span class="s1">          &lt;p style="margin: 6px 0 6px; font-size: 0.72rem; letter-spacing: 3px; text-transform: uppercase; opacity:0.75; color: rgba(58,36,48,0.72);"&gt;</span></p>
<p class="p1"><span class="s1">            Spend 3 tokens on traits that feel like you</span></p>
<p class="p1"><span class="s1">          &lt;/p&gt;</span></p>
<p class="p1"><span class="s1">          &lt;p class="tiny-note" style="margin-top:6px;"&gt;Tap to place. Tap again to return.&lt;/p&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">          &lt;div class="token-top"&gt;</span></p>
<p class="p1"><span class="s1">            &lt;div class="token-badge"&gt;</span></p>
<p class="p1"><span class="s1">              &lt;span&gt;Tokens left&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">              &lt;span class="token-dots" id="a-tokenDots"&gt;&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">            &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">            &lt;button class="btn" id="a-tokenClear" type="button"&gt;Clear&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">            &lt;button class="btn btn-save" id="a-beginRecognition" type="button" disabled&gt;Begin Recognition&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">            &lt;button class="btn btn-sound active" id="a-soundBtnTop" type="button"&gt;Sound: On&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">          &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">          &lt;div class="trait-grid" id="a-traitGrid"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">          &lt;p class="tiny-note" id="a-tokenStatus"&gt;&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">        &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        &lt;!-- RECOGNITION SCREEN --&gt;</span></p>
<p class="p1"><span class="s1">        &lt;div id="a-recognition-screen" style="display:none;"&gt;</span></p>
<p class="p1"><span class="s1">          &lt;div class="panel"&gt;</span></p>
<p class="p1"><span class="s1">            &lt;p style="margin: 0; font-size: 0.62rem; letter-spacing: 3px; text-transform: uppercase; opacity:0.75; color: rgba(58,36,48,0.70);"&gt;Recognition&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">            &lt;div class="recognition-line" id="a-recognitionLine"&gt;“Love is learned before it is chosen.”&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">            &lt;div class="note" id="a-countdownText"&gt;Continue unlocks in 3s&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">            &lt;div style="margin-top:14px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap;"&gt;</span></p>
<p class="p1"><span class="s1">              &lt;button class="btn" id="a-backToTokens" type="button"&gt;Back&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">              &lt;button class="btn btn-save" id="a-continueToSlip" type="button" disabled&gt;Continue&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">            &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">            &lt;p class="tiny-note"&gt;Take what resonates, leave what doesn’t.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">          &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">        &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        &lt;!-- RESULT SCREEN --&gt;</span></p>
<p class="p1"><span class="s1">        &lt;div id="a-result-screen"&gt;</span></p>
<p class="p1"><span class="s1">          &lt;div id="a-capture-frame"&gt;</span></p>
<p class="p1"><span class="s1">            &lt;span style="font-size:0.55rem; letter-spacing:4px; text-transform:uppercase; color: rgba(var(--gold-rgb),0.88); display:block; margin-bottom:18px;"&gt;</span></p>
<p class="p1"><span class="s1">              ISA Chulalongkorn</span></p>
<p class="p1"><span class="s1">            &lt;/span&gt;</span></p>
<p class="p1"><span class="s1">            &lt;h2 style="font-family:'Pinyon Script',cursive; font-size:2.8rem; margin:0; line-height:1.02;</span></p>
<p class="p1"><span class="s1">             -webkit-background-clip:text; background-clip:text; color:transparent;"&gt;</span></p>
<p class="p1"><span class="s1">              Heart to Heart</span></p>
<p class="p1"><span class="s1">            &lt;/h2&gt;</span></p>
<p class="p1"><span class="s1">            &lt;div id="a-seal" class="seal-a"&gt;Seal: —&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">            &lt;div class="pill-row"&gt;</span></p>
<p class="p1"><span class="s1">              &lt;span class="pill" id="a-pill-primary"&gt;House: —&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">              &lt;span class="pill" id="a-pill-secondary"&gt;Secondary: —&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">            &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">            &lt;div style="font-family:'Playfair Display',serif; font-size: clamp(1.15rem, 4vw, 1.55rem); line-height: 1.35; margin: 18px 0 12px; font-style: italic; color: rgba(58,36,48,0.92);" id="a-frontLine"&gt;&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">            &lt;div style="text-align:left; margin-top: 12px; padding-top: 12px; border-top: 0.8px solid rgba(58,36,48,0.10);"&gt;</span></p>
<p class="p1"><span class="s1">              &lt;span style="font-size:0.52rem; letter-spacing:2px; text-transform:uppercase; color: rgba(var(--gold-rgb),0.86); display:block; margin-bottom:6px;"&gt;Articulation&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">              &lt;div style="font-family:'Playfair Display',serif; font-size: 1.05rem; line-height: 1.65; color: rgba(58,36,48,0.88);" id="a-articulationText"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">            &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">            &lt;div style="text-align:left; margin-top: 12px; padding-top: 12px; border-top: 0.8px solid rgba(58,36,48,0.10);"&gt;</span></p>
<p class="p1"><span class="s1">              &lt;span style="font-size:0.52rem; letter-spacing:2px; text-transform:uppercase; color: rgba(var(--gold-rgb),0.86); display:block; margin-bottom:6px;"&gt;House Analysis&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">              &lt;div style="font-size: 0.90rem; opacity: 0.92; line-height: 1.6; color: rgba(58,36,48,0.84);" id="a-houseText"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">            &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">            &lt;div style="text-align:left; margin-top: 12px; padding-top: 12px; border-top: 0.8px solid rgba(58,36,48,0.10);"&gt;</span></p>
<p class="p1"><span class="s1">              &lt;span style="font-size:0.52rem; letter-spacing:2px; text-transform:uppercase; color: rgba(var(--gold-rgb),0.86); display:block; margin-bottom:6px;"&gt;Context&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">              &lt;div style="font-size: 0.90rem; opacity: 0.92; line-height: 1.6; color: rgba(58,36,48,0.84);" id="a-contextText"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">            &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">            &lt;div style="text-align:left; margin-top: 12px; padding-top: 12px; border-top: 0.8px solid rgba(58,36,48,0.10);"&gt;</span></p>
<p class="p1"><span class="s1">              &lt;span style="font-size:0.52rem; letter-spacing:2px; text-transform:uppercase; color: rgba(var(--gold-rgb),0.86); display:block; margin-bottom:6px;"&gt;Counsel meant for you&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">              &lt;div style="margin-top: 8px; padding: 14px 14px; border-radius: 14px; border: 1px solid rgba(var(--gold-rgb),0.22); background: rgba(255,255,255,0.55); position: relative;"&gt;</span></p>
<p class="p1"><span class="s1">                &lt;div style="font-family:'Playfair Display',serif; font-size: 1.02rem; line-height: 1.55; color: rgba(58,36,48,0.88);" id="a-counselText"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">              &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">            &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">          &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">          &lt;div style="margin-top:22px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap;"&gt;</span></p>
<p class="p1"><span class="s1">            &lt;button class="btn" id="a-resetBtn" type="button"&gt;Reset&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">            &lt;button class="btn btn-save" id="a-saveBtn" type="button"&gt;Save Picture&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">            &lt;button class="btn btn-sound active" id="a-soundBtnResult" type="button"&gt;Sound: On&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">            &lt;button class="btn" id="a-goB" type="button"&gt;Continue → Garden Deck&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">          &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">          &lt;p class="tiny-note"&gt;If your device blocks downloads (iPhone/iPad), it will open the image in a new tab → long-press → “Save Image”.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">        &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">      &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">    &lt;/section&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    &lt;!-- EXPERIENCE B --&gt;</span></p>
<p class="p1"><span class="s1">    &lt;section id="expB" class="view"&gt;</span></p>
<p class="p1"><span class="s1">      &lt;div class="topbar"&gt;</span></p>
<p class="p1"><span class="s1">        &lt;button class="navbtn" id="b-home" type="button"&gt;← Menu&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">      &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      &lt;div class="container"&gt;</span></p>
<p class="p1"><span class="s1">        &lt;div id="b-ritual-screen"&gt;</span></p>
<p class="p1"><span class="s1">          &lt;p class="isa-tag"&gt;ISA Chulalongkorn Presents&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">          &lt;h1 class="main-title"&gt;Heart to Heart&lt;/h1&gt;</span></p>
<p class="p1"><span class="s1">          &lt;p class="sub-theme"&gt;The Secret Garden&lt;/p&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">          &lt;div class="deck-area" id="b-deck-container"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">          &lt;p id="b-status-text" style="margin-top: 40px; font-size: 0.7rem; letter-spacing: 3px; text-transform: uppercase; color: rgba(var(--green-rgb),0.70);"&gt;</span></p>
<p class="p1"><span class="s1">            Tap the deck to begin</span></p>
<p class="p1"><span class="s1">          &lt;/p&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">          &lt;div style="margin-top:18px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap;"&gt;</span></p>
<p class="p1"><span class="s1">            &lt;button class="btn btn-sound active" id="b-soundBtnTop" type="button"&gt;Sound: On&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">          &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">          &lt;p class="note"&gt;(One toggle for both rituals.)&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">        &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        &lt;div id="b-result-screen"&gt;</span></p>
<p class="p1"><span class="s1">          &lt;div id="b-capture-frame"&gt;</span></p>
<p class="p1"><span class="s1">            &lt;div id="b-seal" class="seal-b"&gt;Under this seal · —&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">            &lt;span style="font-size:0.55rem; letter-spacing:4px; text-transform:uppercase; color: rgba(var(--gold-rgb),0.88); display:block; margin-bottom:18px;"&gt;</span></p>
<p class="p1"><span class="s1">              ISA Chulalongkorn</span></p>
<p class="p1"><span class="s1">            &lt;/span&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">            &lt;h2 style="font-family:'Pinyon Script',cursive; font-size:2.8rem; margin:0; line-height:1.02;</span></p>
<p class="p1"><span class="s1">              background: linear-gradient(135deg, rgba(var(--green-rgb),0.92), rgba(var(--gold-rgb),0.88));</span></p>
<p class="p1"><span class="s1">              -webkit-background-clip:text; background-clip:text; color:transparent;"&gt;</span></p>
<p class="p1"><span class="s1">              Heart to Heart</span></p>
<p class="p1"><span class="s1">            &lt;/h2&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">            &lt;div id="b-cardCanvas" class="card-canvas" data-mode="decor"&gt;</span></p>
<p class="p1"><span class="s1">              &lt;div id="b-photoFrame" class="photo-frame"&gt;</span></p>
<p class="p1"><span class="s1">                &lt;img id="b-userPhoto" alt="Your photo" /&gt;</span></p>
<p class="p1"><span class="s1">              &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">              &lt;div id="b-decorLayer" class="decor-layer"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">            &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">            &lt;div id="b-caption"&gt;—&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">            &lt;div style="font-family:'Playfair Display',serif; font-size:clamp(1.12rem, 4.1vw, 1.75rem); line-height:1.38; margin:18px 0 14px; font-style:italic; color: rgba(var(--green-rgb),0.88);" id="b-quote-text"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">            &lt;div style="font-size:0.72rem; letter-spacing:3px; text-transform:uppercase; opacity:0.62; color: rgba(var(--green-rgb),0.72);" id="b-quote-source"&gt;&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">            &lt;div style="display:flex; justify-content:space-between; gap:14px; margin-top:22px; padding-top:16px; border-top:0.8px solid rgba(58,36,48,0.08); text-align:left;"&gt;</span></p>
<p class="p1"><span class="s1">              &lt;div&gt;</span></p>
<p class="p1"><span class="s1">                &lt;span style="font-size:0.5rem; letter-spacing:2px; text-transform:uppercase; color: rgba(var(--gold-rgb),0.88); display:block;"&gt;Cinematic&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">                &lt;span style="font-family:'Playfair Display',serif; font-size:0.95rem;" id="b-movie-title"&gt;&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">              &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">              &lt;div&gt;</span></p>
<p class="p1"><span class="s1">                &lt;span style="font-size:0.5rem; letter-spacing:2px; text-transform:uppercase; color: rgba(var(--gold-rgb),0.88); display:block;"&gt;Literary&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">                &lt;span style="font-family:'Playfair Display',serif; font-size:0.95rem;" id="b-book-title"&gt;&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">              &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">            &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">          &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">          &lt;div class="decorate-panel"&gt;</span></p>
<p class="p1"><span class="s1">            &lt;div class="decorate-row"&gt;</span></p>
<p class="p1"><span class="s1">              &lt;div class="pill"&gt;</span></p>
<p class="p1"><span class="s1">                Mode:</span></p>
<p class="p1"><span class="s1">                &lt;select id="b-modeSelect"&gt;</span></p>
<p class="p1"><span class="s1">                  &lt;option value="decor" selected&gt;Mode B — Emojis Only&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">                  &lt;option value="hybrid"&gt;Mode A — Photo + Emojis&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">                &lt;/select&gt;</span></p>
<p class="p1"><span class="s1">              &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">              &lt;div class="pill" id="b-photoInputWrap" style="display:none;"&gt;</span></p>
<p class="p1"><span class="s1">                Add Photo:</span></p>
<p class="p1"><span class="s1">                &lt;input id="b-photoInput" type="file" accept="image/*" /&gt;</span></p>
<p class="p1"><span class="s1">              &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">              &lt;div class="pill"&gt;</span></p>
<p class="p1"><span class="s1">                Symbol:</span></p>
<p class="p1"><span class="s1">                &lt;select id="b-stickerSelect"&gt;</span></p>
<p class="p1"><span class="s1">                  &lt;option value="🩷"&gt;🩷 Pink Heart&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">                  &lt;option value="❤️"&gt;❤️ Red Heart&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">                  &lt;option value="✨"&gt;✨ Sparkles&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">                  &lt;option value="🎀"&gt;🎀 Ribbon&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">                  &lt;option value="🌸"&gt;🌸 Blossom&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">                  &lt;option value="🦋"&gt;🦋 Butterfly&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">                  &lt;option value="💌"&gt;💌 Love Letter&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">                  &lt;option value="♡"&gt;♡ Simple Heart&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">                  &lt;option value="❦"&gt;❦ Ornament&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">                  &lt;option value="୨୧"&gt;୨୧ Ribbon&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">                &lt;/select&gt;</span></p>
<p class="p1"><span class="s1">              &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">              &lt;div class="pill"&gt;</span></p>
<p class="p1"><span class="s1">                Size:</span></p>
<p class="p1"><span class="s1">                &lt;input id="b-stickerSize" type="range" min="16" max="96" value="34" /&gt;</span></p>
<p class="p1"><span class="s1">              &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">            &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">            &lt;div class="decorate-row"&gt;</span></p>
<p class="p1"><span class="s1">              &lt;button class="btn" id="b-placeStickerBtn" type="button"&gt;Place Sticker&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">              &lt;button class="btn" id="b-clearStickersBtn" type="button"&gt;Clear&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">            &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">         </span></p>
<p class="p1"><span class="s1">          &lt;div style="margin-top:18px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap;"&gt;</span></p>
<p class="p1"><span class="s1">            &lt;button class="btn" id="b-resetBtn" type="button"&gt;Reset&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">            &lt;button class="btn btn-save" id="b-saveBtn" type="button"&gt;Save Picture&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">            &lt;button class="btn btn-sound active" id="b-soundBtnResult" type="button"&gt;Sound: On&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">          &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">          &lt;p class="tiny-note"&gt;</span></p>
<p class="p1"><span class="s1">  If iOS blocks the download, the image will open instead. Long-press it and choose “Save Image”.</span></p>
<p class="p1"><span class="s1">         &lt;/p&gt;</span></p>
<p class="p1"><span class="s1">        &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">      &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">    &lt;/section&gt;</span></p>
<p class="p1"><span class="s1">  &lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">  &lt;script&gt;</span></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       HELPERS</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    const views = ["home","expA","expB"];</span></p>
<p class="p1"><span class="s1">    const el = (id)=&gt;document.getElementById(id);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    // iOS Safari often blocks programmatic downloads.</span></p>
<p class="p1"><span class="s1">    // This function tries download; if blocked it opens the image in a new tab for manual save.</span></p>
<p class="p1"><span class="s1">    async function exportElementAsPNG(node, filename){</span></p>
<p class="p1"><span class="s1">      const dpr = Math.min(2.5, Math.max(1.5, window.devicePixelRatio || 2)); // crisp but safe on mobile memory</span></p>
<p class="p1"><span class="s1">      const canvas = await html2canvas(node, {</span></p>
<p class="p1"><span class="s1">        backgroundColor: null,</span></p>
<p class="p1"><span class="s1">        scale: dpr,</span></p>
<p class="p1"><span class="s1">        useCORS: true,</span></p>
<p class="p1"><span class="s1">        allowTaint: true,</span></p>
<p class="p1"><span class="s1">        logging: false,</span></p>
<p class="p1"><span class="s1">        scrollX: 0,</span></p>
<p class="p1"><span class="s1">        scrollY: -window.scrollY</span></p>
<p class="p1"><span class="s1">      });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const toBlob = (c) =&gt; new Promise((resolve) =&gt; {</span></p>
<p class="p1"><span class="s1">        if (c.toBlob) c.toBlob(resolve, "image/png", 1);</span></p>
<p class="p1"><span class="s1">        else resolve(null);</span></p>
<p class="p1"><span class="s1">      });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const blob = await toBlob(canvas);</span></p>
<p class="p1"><span class="s1">      if (blob) {</span></p>
<p class="p1"><span class="s1">        const url = URL.createObjectURL(blob);</span></p>
<p class="p1"><span class="s1">        const a = document.createElement("a");</span></p>
<p class="p1"><span class="s1">        a.href = url;</span></p>
<p class="p1"><span class="s1">        a.download = filename;</span></p>
<p class="p1"><span class="s1">        a.rel = "noopener";</span></p>
<p class="p1"><span class="s1">        document.body.appendChild(a);</span></p>
<p class="p1"><span class="s1">        // Some browsers need the click to be directly inside the user gesture; this still works in most cases.</span></p>
<p class="p1"><span class="s1">        a.click();</span></p>
<p class="p1"><span class="s1">        a.remove();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        // If iOS ignores download, open a tab fallback (user can long-press save).</span></p>
<p class="p1"><span class="s1">        // We detect iOS-ish + no "download" support.</span></p>
<p class="p1"><span class="s1">        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === "MacIntel" &amp;&amp; navigator.maxTouchPoints &gt; 1);</span></p>
<p class="p1"><span class="s1">        const canDownload = "download" in HTMLAnchorElement.prototype;</span></p>
<p class="p1"><span class="s1">        if (isIOS || !canDownload) {</span></p>
<p class="p1"><span class="s1">          window.open(url, "_blank", "noopener,noreferrer");</span></p>
<p class="p1"><span class="s1">        }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        setTimeout(()=&gt;URL.revokeObjectURL(url), 60000);</span></p>
<p class="p1"><span class="s1">        return;</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      // Worst-case: dataURL</span></p>
<p class="p1"><span class="s1">      const dataUrl = canvas.toDataURL("image/png");</span></p>
<p class="p1"><span class="s1">      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === "MacIntel" &amp;&amp; navigator.maxTouchPoints &gt; 1);</span></p>
<p class="p1"><span class="s1">      if (isIOS) window.open(dataUrl, "_blank", "noopener,noreferrer");</span></p>
<p class="p1"><span class="s1">      else {</span></p>
<p class="p1"><span class="s1">        const a = document.createElement("a");</span></p>
<p class="p1"><span class="s1">        a.href = dataUrl;</span></p>
<p class="p1"><span class="s1">        a.download = filename;</span></p>
<p class="p1"><span class="s1">        document.body.appendChild(a);</span></p>
<p class="p1"><span class="s1">        a.click();</span></p>
<p class="p1"><span class="s1">        a.remove();</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       SHARED RITUAL STATE (A -&gt; B)</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    const Ritual = {</span></p>
<p class="p1"><span class="s1">      primaryKey: null,</span></p>
<p class="p1"><span class="s1">      secondaryKey: null,</span></p>
<p class="p1"><span class="s1">      seal: null,</span></p>
<p class="p1"><span class="s1">      counsel: null,</span></p>
<p class="p1"><span class="s1">      pattern: null,</span></p>
<p class="p1"><span class="s1">      slip: null,</span></p>
<p class="p1"><span class="s1">      traitTokens: null</span></p>
<p class="p1"><span class="s1">    };</span></p>
<p class="p1"><span class="s1">    function getShortSeal(){</span></p>
<p class="p1"><span class="s1">      if (!Ritual.seal) return "—";</span></p>
<p class="p1"><span class="s1">      return Ritual.seal.replace("ISA-H2H-", "");</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       HOUSE STYLE (A drives B)</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    const HOUSE_STYLE = {</span></p>
<p class="p1"><span class="s1">      family:   { crest:"♠", petals:22, birdRate:0.45, shimmer:0.10, mode:"warm" },</span></p>
<p class="p1"><span class="s1">      religion: { crest:"❦", petals:22, birdRate:0.40, shimmer:0.08, mode:"warm" },</span></p>
<p class="p1"><span class="s1">      media:    { crest:"♥", petals:12, birdRate:0.25, shimmer:0.28, mode:"cool" },</span></p>
<p class="p1"><span class="s1">      internet: { crest:"</span><span class="s2">♦</span><span class="s1">", petals:10, birdRate:0.20, shimmer:0.32, mode:"cool" },</span></p>
<p class="p1"><span class="s1">      school:   { crest:"♣", petals:14, birdRate:0.30, shimmer:0.14, mode:"clean" }</span></p>
<p class="p1"><span class="s1">    };</span></p>
<p class="p1"><span class="s1">    function getHouseKeyForB(){ return Ritual.primaryKey || "family"; }</span></p>
<p class="p1"><span class="s1">    function getStyleForB(){ return HOUSE_STYLE[getHouseKeyForB()] || HOUSE_STYLE.family; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       ROUTER + LAYERS</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    function setThemeFor(view){</span></p>
<p class="p1"><span class="s1">      if(view === "expA"){</span></p>
<p class="p1"><span class="s1">        el("bgA").classList.add("on");</span></p>
<p class="p1"><span class="s1">        el("motesA").classList.add("on");</span></p>
<p class="p1"><span class="s1">        el("bgB").classList.remove("on");</span></p>
<p class="p1"><span class="s1">        el("petalsB").classList.remove("on");</span></p>
<p class="p1"><span class="s1">        el("birdsB").classList.remove("on");</span></p>
<p class="p1"><span class="s1">        el("vignette").classList.add("on");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        document.documentElement.style.setProperty("--bg", "#FFF7F2");</span></p>
<p class="p1"><span class="s1">        document.documentElement.style.setProperty("--fg", getComputedStyle(document.documentElement).getPropertyValue("--ink"));</span></p>
<p class="p1"><span class="s1">        document.body.style.backgroundColor = "#FFF7F2";</span></p>
<p class="p1"><span class="s1">        document.body.style.color = getComputedStyle(document.documentElement).getPropertyValue("--ink");</span></p>
<p class="p1"><span class="s1">        if(audioPrimed) setPianoMood("A");</span></p>
<p class="p1"><span class="s1">      } else if(view === "expB"){</span></p>
<p class="p1"><span class="s1">        el("bgA").classList.remove("on");</span></p>
<p class="p1"><span class="s1">        el("motesA").classList.remove("on");</span></p>
<p class="p1"><span class="s1">        el("bgB").classList.add("on");</span></p>
<p class="p1"><span class="s1">        el("petalsB").classList.add("on");</span></p>
<p class="p1"><span class="s1">        el("birdsB").classList.add("on");</span></p>
<p class="p1"><span class="s1">        el("vignette").classList.add("on");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        applyHouseMoodToGarden();</span></p>
<p class="p1"><span class="s1">        document.documentElement.style.setProperty("--bg", "#FFFEFA");</span></p>
<p class="p1"><span class="s1">        document.documentElement.style.setProperty("--fg", getComputedStyle(document.documentElement).getPropertyValue("--deep-green"));</span></p>
<p class="p1"><span class="s1">        document.body.style.backgroundColor = "#FFFEFA";</span></p>
<p class="p1"><span class="s1">        document.body.style.color = getComputedStyle(document.documentElement).getPropertyValue("--deep-green");</span></p>
<p class="p1"><span class="s1">        if(audioPrimed) setPianoMood("B");</span></p>
<p class="p1"><span class="s1">      } else {</span></p>
<p class="p1"><span class="s1">        el("bgA").classList.remove("on");</span></p>
<p class="p1"><span class="s1">        el("motesA").classList.remove("on");</span></p>
<p class="p1"><span class="s1">        el("bgB").classList.remove("on");</span></p>
<p class="p1"><span class="s1">        el("petalsB").classList.remove("on");</span></p>
<p class="p1"><span class="s1">        el("birdsB").classList.remove("on");</span></p>
<p class="p1"><span class="s1">        el("vignette").classList.remove("on");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        document.documentElement.style.setProperty("--bg", "#FFFBF4");</span></p>
<p class="p1"><span class="s1">        document.documentElement.style.setProperty("--fg", getComputedStyle(document.documentElement).getPropertyValue("--ink"));</span></p>
<p class="p1"><span class="s1">        document.body.style.backgroundColor = "#FFFBF4";</span></p>
<p class="p1"><span class="s1">        document.body.style.color = getComputedStyle(document.documentElement).getPropertyValue("--ink");</span></p>
<p class="p1"><span class="s1">        if(audioPrimed) setPianoMood("A");</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">      // "instant" is not a valid scroll behavior; use auto.</span></p>
<p class="p1"><span class="s1">      el("app").scrollTo({ top: 0, behavior: "auto" });</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function showView(id){</span></p>
<p class="p1"><span class="s1">      views.forEach(v=&gt;{</span></p>
<p class="p1"><span class="s1">        const sec = el(v);</span></p>
<p class="p1"><span class="s1">        if(!sec) return;</span></p>
<p class="p1"><span class="s1">        sec.classList.toggle("active", v === id);</span></p>
<p class="p1"><span class="s1">      });</span></p>
<p class="p1"><span class="s1">      setThemeFor(id);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function bindCardNav(cardId, go){</span></p>
<p class="p1"><span class="s1">      const node = el(cardId);</span></p>
<p class="p1"><span class="s1">      node.addEventListener("click", go);</span></p>
<p class="p1"><span class="s1">      node.addEventListener("keydown", (e)=&gt;{</span></p>
<p class="p1"><span class="s1">        if(e.key === "Enter" || e.key === " "){ e.preventDefault(); go(); }</span></p>
<p class="p1"><span class="s1">      });</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    bindCardNav("goA", ()=&gt; showView("expA"));</span></p>
<p class="p1"><span class="s1">    bindCardNav("goB", ()=&gt; showView("expB"));</span></p>
<p class="p1"><span class="s1">    el("a-home").addEventListener("click", ()=&gt; showView("home"));</span></p>
<p class="p1"><span class="s1">    el("b-home").addEventListener("click", ()=&gt; showView("home"));</span></p>
<p class="p1"><span class="s1">    el("a-goB").addEventListener("click", ()=&gt; showView("expB"));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       HEART FLOATERS (A)</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    const motesHostA = el("motesA");</span></p>
<p class="p1"><span class="s1">    function heartSVG_A({ glow=0.22 } = {}) {</span></p>
<p class="p1"><span class="s1">      return `</span></p>
<p class="p1"><span class="s1">        &lt;svg viewBox="0 0 64 64" aria-hidden="true"&gt;</span></p>
<p class="p1"><span class="s1">          &lt;defs&gt;</span></p>
<p class="p1"><span class="s1">            &lt;linearGradient id="hgrad" x1="0" y1="0" x2="1" y2="1"&gt;</span></p>
<p class="p1"><span class="s1">              &lt;stop offset="0" stop-color="rgba(212,175,55,0.98)"/&gt;</span></p>
<p class="p1"><span class="s1">              &lt;stop offset="0.35" stop-color="rgba(178,30,53,0.88)"/&gt;</span></p>
<p class="p1"><span class="s1">              &lt;stop offset="1" stop-color="rgba(123,30,43,0.88)"/&gt;</span></p>
<p class="p1"><span class="s1">            &lt;/linearGradient&gt;</span></p>
<p class="p1"><span class="s1">            &lt;filter id="softGlow" x="-40%" y="-40%" width="180%" height="180%"&gt;</span></p>
<p class="p1"><span class="s1">              &lt;feGaussianBlur stdDeviation="2.6" result="b"/&gt;</span></p>
<p class="p1"><span class="s1">              &lt;feColorMatrix in="b" type="matrix"</span></p>
<p class="p1"><span class="s1">                values="1 0 0 0 0</span></p>
<p class="p1"><span class="s1">                        0 1 0 0 0</span></p>
<p class="p1"><span class="s1">                        0 0 1 0 0</span></p>
<p class="p1"><span class="s1">                        0 0 0 ${glow} 0" result="g"/&gt;</span></p>
<p class="p1"><span class="s1">              &lt;feMerge&gt;</span></p>
<p class="p1"><span class="s1">                &lt;feMergeNode in="g"/&gt;</span></p>
<p class="p1"><span class="s1">                &lt;feMergeNode in="SourceGraphic"/&gt;</span></p>
<p class="p1"><span class="s1">              &lt;/feMerge&gt;</span></p>
<p class="p1"><span class="s1">            &lt;/filter&gt;</span></p>
<p class="p1"><span class="s1">          &lt;/defs&gt;</span></p>
<p class="p1"><span class="s1">          &lt;path filter="url(#softGlow)"</span></p>
<p class="p1"><span class="s1">            d="M32 54s-18.7-10.9-25.2-22.5C1.6 20.7 7.8 10 18.9 10c5.2 0 9.6 2.6 13.1 7</span></p>
<p class="p1"><span class="s1">               3.5-4.4 7.9-7 13.1-7C56.2 10 62.4 20.7 57.2 31.5 50.7 43.1 32 54 32 54z"</span></p>
<p class="p1"><span class="s1">            fill="url(#hgrad)" /&gt;</span></p>
<p class="p1"><span class="s1">        &lt;/svg&gt;</span></p>
<p class="p1"><span class="s1">      `;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    function spawnHeartsA(count = 20){</span></p>
<p class="p1"><span class="s1">      motesHostA.innerHTML = "";</span></p>
<p class="p1"><span class="s1">      for(let i=0;i&lt;count;i++){</span></p>
<p class="p1"><span class="s1">        const wrap = document.createElement("div");</span></p>
<p class="p1"><span class="s1">        wrap.className = "heart-mote";</span></p>
<p class="p1"><span class="s1">        const x = Math.random() * 100;</span></p>
<p class="p1"><span class="s1">        const x2 = Math.max(0, Math.min(100, x + (Math.random()*22 - 11)));</span></p>
<p class="p1"><span class="s1">        const dur = 10 + Math.random() * 16;</span></p>
<p class="p1"><span class="s1">        const delay = Math.random() * 10;</span></p>
<p class="p1"><span class="s1">        const s = (0.45 + Math.random() * 1.35).toFixed(2);</span></p>
<p class="p1"><span class="s1">        const r = (-18 + Math.random()*36).toFixed(1) + "deg";</span></p>
<p class="p1"><span class="s1">        wrap.style.setProperty("--x", x + "vw");</span></p>
<p class="p1"><span class="s1">        wrap.style.setProperty("--x2", x2 + "vw");</span></p>
<p class="p1"><span class="s1">        wrap.style.setProperty("--s", s);</span></p>
<p class="p1"><span class="s1">        wrap.style.setProperty("--r", r);</span></p>
<p class="p1"><span class="s1">        wrap.style.animationDuration = dur + "s";</span></p>
<p class="p1"><span class="s1">        wrap.style.animationDelay = delay + "s";</span></p>
<p class="p1"><span class="s1">        const size = 16 + Math.random()*26;</span></p>
<p class="p1"><span class="s1">        wrap.style.width = size + "px";</span></p>
<p class="p1"><span class="s1">        wrap.style.height = size + "px";</span></p>
<p class="p1"><span class="s1">        wrap.innerHTML = heartSVG_A({ glow: 0.22 });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        const svg = wrap.querySelector("svg");</span></p>
<p class="p1"><span class="s1">        const uid = "h" + Math.random().toString(16).slice(2);</span></p>
<p class="p1"><span class="s1">        svg.innerHTML = svg.innerHTML</span></p>
<p class="p1"><span class="s1">          .replaceAll("hgrad", uid + "g")</span></p>
<p class="p1"><span class="s1">          .replaceAll("softGlow", uid + "f");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        motesHostA.appendChild(wrap);</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    spawnHeartsA(20);</span></p>
<p class="p1"><span class="s1">    window.addEventListener("resize", ()=&gt; spawnHeartsA(window.innerWidth &lt; 480 ? 14 : 20));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       PETALS + BIRDS (B)</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    const petalsHostB = el("petalsB");</span></p>
<p class="p1"><span class="s1">    function spawnPetalsB(count = 18) {</span></p>
<p class="p1"><span class="s1">      petalsHostB.innerHTML = '';</span></p>
<p class="p1"><span class="s1">      for (let i = 0; i &lt; count; i++) {</span></p>
<p class="p1"><span class="s1">        const p = document.createElement('div');</span></p>
<p class="p1"><span class="s1">        p.className = 'petal';</span></p>
<p class="p1"><span class="s1">        const left = Math.random() * 100;</span></p>
<p class="p1"><span class="s1">        const dur = 10 + Math.random() * 12;</span></p>
<p class="p1"><span class="s1">        const delay = Math.random() * 8;</span></p>
<p class="p1"><span class="s1">        const size = 8 + Math.random() * 10;</span></p>
<p class="p1"><span class="s1">        p.style.left = left + 'vw';</span></p>
<p class="p1"><span class="s1">        p.style.animationDuration = dur + 's';</span></p>
<p class="p1"><span class="s1">        p.style.animationDelay = delay + 's';</span></p>
<p class="p1"><span class="s1">        p.style.width = size + "px";</span></p>
<p class="p1"><span class="s1">        p.style.height = (size * 1.5) + "px";</span></p>
<p class="p1"><span class="s1">        p.style.opacity = (0.45 + Math.random() * 0.45).toFixed(2);</span></p>
<p class="p1"><span class="s1">        petalsHostB.appendChild(p);</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    const birdsHostB = el("birdsB");</span></p>
<p class="p1"><span class="s1">    function spawnBirdB() {</span></p>
<p class="p1"><span class="s1">      const bird = document.createElement('div');</span></p>
<p class="p1"><span class="s1">      bird.className = 'bird';</span></p>
<p class="p1"><span class="s1">      const mode = Math.random() &gt; 0.5 ? "up" : "down";</span></p>
<p class="p1"><span class="s1">      const fromX = "-25vw";</span></p>
<p class="p1"><span class="s1">      const toX   = "120vw";</span></p>
<p class="p1"><span class="s1">      const fromY = mode === "up" ? (65 + Math.random() * 25) + "vh" : (10 + Math.random() * 25) + "vh";</span></p>
<p class="p1"><span class="s1">      const toY   = mode === "up" ? (8 + Math.random() * 25)  + "vh" : (55 + Math.random() * 30) + "vh";</span></p>
<p class="p1"><span class="s1">      const dur = 9 + Math.random() * 10;</span></p>
<p class="p1"><span class="s1">      const delay = Math.random() * 2.5;</span></p>
<p class="p1"><span class="s1">      const scale = (0.75 + Math.random() * 0.7).toFixed(2);</span></p>
<p class="p1"><span class="s1">      const opacity = (0.30 + Math.random() * 0.38).toFixed(2);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      bird.style.setProperty('--fromX', fromX);</span></p>
<p class="p1"><span class="s1">      bird.style.setProperty('--toX', toX);</span></p>
<p class="p1"><span class="s1">      bird.style.setProperty('--fromY', fromY);</span></p>
<p class="p1"><span class="s1">      bird.style.setProperty('--toY', toY);</span></p>
<p class="p1"><span class="s1">      bird.style.setProperty('--s', scale);</span></p>
<p class="p1"><span class="s1">      bird.style.animationDuration = dur + "s";</span></p>
<p class="p1"><span class="s1">      bird.style.animationDelay = delay + "s";</span></p>
<p class="p1"><span class="s1">      bird.style.opacity = opacity;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      bird.innerHTML = `</span></p>
<p class="p1"><span class="s1">        &lt;svg viewBox="0 0 120 60" xmlns="http://www.w3.org/2000/svg"&gt;</span></p>
<p class="p1"><span class="s1">          &lt;g fill="none" stroke-linecap="round" stroke="rgba(26,42,29,0.62)"&gt;</span></p>
<p class="p1"><span class="s1">            &lt;path d="M58 36 Q60 34 62 36" stroke-width="3"/&gt;</span></p>
<p class="p1"><span class="s1">            &lt;path class="wing left"  d="M60 36 Q40 18 18 26" stroke-width="3.2"/&gt;</span></p>
<p class="p1"><span class="s1">            &lt;path class="wing right" d="M60 36 Q80 18 102 26" stroke-width="3.2"/&gt;</span></p>
<p class="p1"><span class="s1">          &lt;/g&gt;</span></p>
<p class="p1"><span class="s1">          &lt;g fill="none" stroke-linecap="round" stroke="rgba(212,175,55,0.22)"&gt;</span></p>
<p class="p1"><span class="s1">            &lt;path class="wing left"  d="M60 36 Q43 22 22 28" stroke-width="2.1"/&gt;</span></p>
<p class="p1"><span class="s1">            &lt;path class="wing right" d="M60 36 Q77 22 98 28" stroke-width="2.1"/&gt;</span></p>
<p class="p1"><span class="s1">          &lt;/g&gt;</span></p>
<p class="p1"><span class="s1">        &lt;/svg&gt;</span></p>
<p class="p1"><span class="s1">      `;</span></p>
<p class="p1"><span class="s1">      birdsHostB.appendChild(bird);</span></p>
<p class="p1"><span class="s1">      setTimeout(() =&gt; bird.remove(), (dur + delay + 1) * 1000);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    let birdInterval = null;</span></p>
<p class="p1"><span class="s1">    function setBirdSpawnRate(rate){</span></p>
<p class="p1"><span class="s1">      if (birdInterval) clearInterval(birdInterval);</span></p>
<p class="p1"><span class="s1">      birdInterval = setInterval(() =&gt; {</span></p>
<p class="p1"><span class="s1">        if (Math.random() &lt; rate) spawnBirdB();</span></p>
<p class="p1"><span class="s1">      }, 2200);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function applyHouseMoodToGarden(){</span></p>
<p class="p1"><span class="s1">      const style = getStyleForB();</span></p>
<p class="p1"><span class="s1">      spawnPetalsB(style.petals);</span></p>
<p class="p1"><span class="s1">      setBirdSpawnRate(style.birdRate);</span></p>
<p class="p1"><span class="s1">      el("b-cardCanvas").style.setProperty("--shimmer", String(style.shimmer));</span></p>
<p class="p1"><span class="s1">      if (style.mode === "cool") document.body.style.backgroundColor = "#FFF9F2";</span></p>
<p class="p1"><span class="s1">      else if (style.mode === "clean") document.body.style.backgroundColor = "#FFFEFA";</span></p>
<p class="p1"><span class="s1">      else document.body.style.backgroundColor = "#FFF7EB";</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    spawnPetalsB(18);</span></p>
<p class="p1"><span class="s1">    setBirdSpawnRate(0.30);</span></p>
<p class="p1"><span class="s1">    window.addEventListener('resize', () =&gt; {</span></p>
<p class="p1"><span class="s1">      const style = getStyleForB();</span></p>
<p class="p1"><span class="s1">      spawnPetalsB(window.innerWidth &lt; 480 ? Math.max(10, style.petals - 6) : style.petals);</span></p>
<p class="p1"><span class="s1">    });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       ONE AUDIO ENGINE (PIANO ONLY)</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    let audioCtx = null;</span></p>
<p class="p1"><span class="s1">    let masterGain = null;</span></p>
<p class="p1"><span class="s1">    let pianoGain = null;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    let soundOn = true;</span></p>
<p class="p1"><span class="s1">    let audioPrimed = false;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    let pianoLoopTimer = null;</span></p>
<p class="p1"><span class="s1">    let pianoIsRunning = false;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    let sceneMood = "A"; // "A" or "B"</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function ensureAudio() {</span></p>
<p class="p1"><span class="s1">      if (audioCtx) return;</span></p>
<p class="p1"><span class="s1">      audioCtx = new (window.AudioContext || window.webkitAudioContext)();</span></p>
<p class="p1"><span class="s1">      masterGain = audioCtx.createGain();</span></p>
<p class="p1"><span class="s1">      pianoGain  = audioCtx.createGain();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      masterGain.gain.value = 0.0001;</span></p>
<p class="p1"><span class="s1">      pianoGain.gain.value  = 0.0001;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      pianoGain.connect(masterGain);</span></p>
<p class="p1"><span class="s1">      masterGain.connect(audioCtx.destination);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    async function primeAndApplyAudio() {</span></p>
<p class="p1"><span class="s1">      ensureAudio();</span></p>
<p class="p1"><span class="s1">      if (audioCtx.state === "suspended") {</span></p>
<p class="p1"><span class="s1">        try { await audioCtx.resume(); } catch (e) {}</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">      audioPrimed = true;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const now = audioCtx.currentTime;</span></p>
<p class="p1"><span class="s1">      masterGain.gain.cancelScheduledValues(now);</span></p>
<p class="p1"><span class="s1">      masterGain.gain.setValueAtTime(masterGain.gain.value, now);</span></p>
<p class="p1"><span class="s1">      masterGain.gain.exponentialRampToValueAtTime(soundOn ? 0.65 : 0.0001, now + 0.12);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const currentView = views.find(v =&gt; el(v)?.classList.contains("active")) || "home";</span></p>
<p class="p1"><span class="s1">      setPianoMood(currentView === "expB" ? "B" : "A");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      updateAllSoundButtons();</span></p>
<p class="p1"><span class="s1">      if (soundOn) startPianoAmbience();</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function setSound(on) {</span></p>
<p class="p1"><span class="s1">      soundOn = on;</span></p>
<p class="p1"><span class="s1">      if (!audioPrimed || !audioCtx || !masterGain) { updateAllSoundButtons(); return; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const now = audioCtx.currentTime;</span></p>
<p class="p1"><span class="s1">      masterGain.gain.cancelScheduledValues(now);</span></p>
<p class="p1"><span class="s1">      masterGain.gain.setValueAtTime(masterGain.gain.value, now);</span></p>
<p class="p1"><span class="s1">      masterGain.gain.exponentialRampToValueAtTime(on ? 0.65 : 0.0001, now + 0.12);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      updateAllSoundButtons();</span></p>
<p class="p1"><span class="s1">      if (on) startPianoAmbience();</span></p>
<p class="p1"><span class="s1">      else stopPianoAmbience();</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    function toggleSound(){ setSound(!soundOn); }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function updateAllSoundButtons(){</span></p>
<p class="p1"><span class="s1">      const label = soundOn ? "Sound: On" : "Sound: Off";</span></p>
<p class="p1"><span class="s1">      const ids = ["a-soundBtnTop","a-soundBtnResult","b-soundBtnTop","b-soundBtnResult"];</span></p>
<p class="p1"><span class="s1">      ids.forEach(id=&gt;{</span></p>
<p class="p1"><span class="s1">        const b = el(id);</span></p>
<p class="p1"><span class="s1">        if(!b) return;</span></p>
<p class="p1"><span class="s1">        b.textContent = label;</span></p>
<p class="p1"><span class="s1">        b.classList.toggle("active", soundOn);</span></p>
<p class="p1"><span class="s1">      });</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function setPianoMood(mood){</span></p>
<p class="p1"><span class="s1">      sceneMood = (mood === "B") ? "B" : "A";</span></p>
<p class="p1"><span class="s1">      if (!audioPrimed || !audioCtx || !pianoGain) return;</span></p>
<p class="p1"><span class="s1">      const now = audioCtx.currentTime;</span></p>
<p class="p1"><span class="s1">      pianoGain.gain.cancelScheduledValues(now);</span></p>
<p class="p1"><span class="s1">      pianoGain.gain.setValueAtTime(pianoGain.gain.value, now);</span></p>
<p class="p1"><span class="s1">      const target = soundOn ? (sceneMood === "B" ? 0.62 : 0.55) : 0.0001;</span></p>
<p class="p1"><span class="s1">      pianoGain.gain.exponentialRampToValueAtTime(Math.max(0.0001, target), now + 0.35);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    // Prime sound on first user gesture (iOS/Android safe)</span></p>
<p class="p1"><span class="s1">    (function bindAutoStart() {</span></p>
<p class="p1"><span class="s1">      const once = async () =&gt; {</span></p>
<p class="p1"><span class="s1">        await primeAndApplyAudio();</span></p>
<p class="p1"><span class="s1">        window.removeEventListener("pointerdown", once);</span></p>
<p class="p1"><span class="s1">        window.removeEventListener("keydown", once);</span></p>
<p class="p1"><span class="s1">      };</span></p>
<p class="p1"><span class="s1">      window.addEventListener("pointerdown", once, { passive:true });</span></p>
<p class="p1"><span class="s1">      window.addEventListener("keydown", once);</span></p>
<p class="p1"><span class="s1">    })();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    ["a-soundBtnTop","a-soundBtnResult","b-soundBtnTop","b-soundBtnResult"].forEach(id=&gt;{</span></p>
<p class="p1"><span class="s1">      const btn = el(id);</span></p>
<p class="p1"><span class="s1">      btn?.addEventListener("click", (e)=&gt;{ e.stopPropagation(); toggleSound(); });</span></p>
<p class="p1"><span class="s1">    });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function playTone(freq, { when=0, dur=1.2, vel=0.6, pan=0 } = {}) {</span></p>
<p class="p1"><span class="s1">      if (!audioCtx || !audioPrimed || !soundOn) return;</span></p>
<p class="p1"><span class="s1">      const t0 = audioCtx.currentTime + when;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const osc = audioCtx.createOscillator();</span></p>
<p class="p1"><span class="s1">      osc.type = "triangle";</span></p>
<p class="p1"><span class="s1">      osc.frequency.setValueAtTime(freq, t0);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const click = audioCtx.createOscillator();</span></p>
<p class="p1"><span class="s1">      click.type = "sine";</span></p>
<p class="p1"><span class="s1">      click.frequency.setValueAtTime(freq * 2.0, t0);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const g = audioCtx.createGain();</span></p>
<p class="p1"><span class="s1">      const peak = 0.08 * vel;</span></p>
<p class="p1"><span class="s1">      g.gain.setValueAtTime(0.0001, t0);</span></p>
<p class="p1"><span class="s1">      g.gain.exponentialRampToValueAtTime(peak, t0 + 0.01);</span></p>
<p class="p1"><span class="s1">      g.gain.exponentialRampToValueAtTime(peak * 0.35, t0 + 0.18);</span></p>
<p class="p1"><span class="s1">      g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const filter = audioCtx.createBiquadFilter();</span></p>
<p class="p1"><span class="s1">      filter.type = "lowpass";</span></p>
<p class="p1"><span class="s1">      filter.frequency.setValueAtTime(1800 + vel * 1200, t0);</span></p>
<p class="p1"><span class="s1">      filter.Q.setValueAtTime(0.8, t0);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const delay = audioCtx.createDelay();</span></p>
<p class="p1"><span class="s1">      delay.delayTime.setValueAtTime(0.14, t0);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const fb = audioCtx.createGain();</span></p>
<p class="p1"><span class="s1">      fb.gain.setValueAtTime(0.22, t0);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const wet = audioCtx.createGain();</span></p>
<p class="p1"><span class="s1">      wet.gain.setValueAtTime(0.35, t0);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const dry = audioCtx.createGain();</span></p>
<p class="p1"><span class="s1">      dry.gain.setValueAtTime(0.9, t0);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const panner = audioCtx.createStereoPanner ? audioCtx.createStereoPanner() : null;</span></p>
<p class="p1"><span class="s1">      if (panner) panner.pan.setValueAtTime(Math.max(-1, Math.min(1, pan)), t0);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      osc.connect(filter);</span></p>
<p class="p1"><span class="s1">      click.connect(filter);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      filter.connect(dry);  dry.connect(g);</span></p>
<p class="p1"><span class="s1">      filter.connect(delay); delay.connect(fb); fb.connect(delay); delay.connect(wet); wet.connect(g);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      if (panner) { g.connect(panner); panner.connect(pianoGain); }</span></p>
<p class="p1"><span class="s1">      else { g.connect(pianoGain); }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      osc.start(t0); click.start(t0);</span></p>
<p class="p1"><span class="s1">      osc.stop(t0 + dur + 0.05);</span></p>
<p class="p1"><span class="s1">      click.stop(t0 + 0.03);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    const CHORDS_A = [</span></p>
<p class="p1"><span class="s1">      [293.66, 369.99, 440.00],</span></p>
<p class="p1"><span class="s1">      [392.00, 493.88, 587.33],</span></p>
<p class="p1"><span class="s1">      [246.94, 293.66, 369.99],</span></p>
<p class="p1"><span class="s1">      [220.00, 293.66, 329.63],</span></p>
<p class="p1"><span class="s1">    ];</span></p>
<p class="p1"><span class="s1">    const CHORDS_B = [</span></p>
<p class="p1"><span class="s1">      [329.63, 415.30, 493.88],</span></p>
<p class="p1"><span class="s1">      [369.99, 466.16, 554.37],</span></p>
<p class="p1"><span class="s1">      [293.66, 369.99, 440.00],</span></p>
<p class="p1"><span class="s1">      [261.63, 329.63, 392.00],</span></p>
<p class="p1"><span class="s1">    ];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function startPianoAmbience() {</span></p>
<p class="p1"><span class="s1">      if (pianoIsRunning) return;</span></p>
<p class="p1"><span class="s1">      pianoIsRunning = true;</span></p>
<p class="p1"><span class="s1">      let step = 0;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const tick = () =&gt; {</span></p>
<p class="p1"><span class="s1">        if (!soundOn || !audioPrimed || !audioCtx) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        const chords = (sceneMood === "B") ? CHORDS_B : CHORDS_A;</span></p>
<p class="p1"><span class="s1">        const chord = chords[step % chords.length];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        const basePan = -0.25 + Math.random() * 0.5;</span></p>
<p class="p1"><span class="s1">        const vel = 0.45 + Math.random() * 0.25;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        playTone(chord[0] / 2, { when: 0.00, dur: 2.2, vel: vel * 0.65, pan: basePan * 0.6 });</span></p>
<p class="p1"><span class="s1">        playTone(chord[0],     { when: 0.05, dur: 1.8, vel: vel,        pan: basePan });</span></p>
<p class="p1"><span class="s1">        playTone(chord[1],     { when: 0.32, dur: 1.6, vel: vel * 0.90, pan: basePan * 0.8 });</span></p>
<p class="p1"><span class="s1">        playTone(chord[2],     { when: 0.62, dur: 1.4, vel: vel * 0.85, pan: basePan * 0.6 });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        step++;</span></p>
<p class="p1"><span class="s1">        pianoLoopTimer = setTimeout(tick, 2400);</span></p>
<p class="p1"><span class="s1">      };</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      tick();</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function stopPianoAmbience() {</span></p>
<p class="p1"><span class="s1">      pianoIsRunning = false;</span></p>
<p class="p1"><span class="s1">      if (pianoLoopTimer) { clearTimeout(pianoLoopTimer); pianoLoopTimer = null; }</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function softChime(type = "place") {</span></p>
<p class="p1"><span class="s1">      const map = { place:[659.25,880.0], gate:[523.25,659.25], reveal:[392.0,523.25] };</span></p>
<p class="p1"><span class="s1">      const seq = map[type] || map.place;</span></p>
<p class="p1"><span class="s1">      playTone(seq[0], { when: 0.00, dur: 0.55, vel: 0.35, pan: -0.05 });</span></p>
<p class="p1"><span class="s1">      playTone(seq[1], { when: 0.08, dur: 0.60, vel: 0.30, pan:  0.08 });</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       EXPERIENCE A LOGIC (tokens)</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    const teachers = {</span></p>
<p class="p1"><span class="s1">      family: { </span></p>
<p class="p1"><span class="s1">    label: "House of Kin",</span></p>
<p class="p1"><span class="s1">        analysis: "This House learns love through responsibility and belonging. It values steadiness but often struggles with the weight of invisible expectations.",</span></p>
<p class="p1"><span class="s1">    slips: [</span></p>
<p class="p1"><span class="s1">      { // 0: The Shield</span></p>
<p class="p1"><span class="s1">        pattern: "You keep peace by shrinking your needs.",</span></p>
<p class="p1"><span class="s1">        articulation: "When harmony is the rule, wanting more feels like a threat to the family unit. You become easy to live with, but impossible to truly know.",</span></p>
<p class="p1"><span class="s1">        context: "In high-context families, silence is often mistaken for contentment. Over time, this 'ease' turns into quiet resentment.",</span></p>
<p class="p1"><span class="s1">        counsel: "Practice gentle disruption: Speak one true preference today, even if it’s just about dinner."</span></p>
<p class="p1"><span class="s1">      },</span></p>
<p class="p1"><span class="s1">      { // 1: The Armor</span></p>
<p class="p1"><span class="s1">        pattern: "You protect closeness by over-functioning.",</span></p>
<p class="p1"><span class="s1">        articulation: "You've learned that staying means 'doing.' You assume the role of the fixer or the anchor to ensure you remain indispensable.",</span></p>
<p class="p1"><span class="s1">        context: "Responsibility can be a mask for the fear of being cast out. You believe you are only as good as the peace you maintain.",</span></p>
<p class="p1"><span class="s1">        counsel: "Let something stay broken for a day. Notice that you are still loved even when you aren't helping."</span></p>
<p class="p1"><span class="s1">      },</span></p>
<p class="p1"><span class="s1">      { // 2: The Pulse</span></p>
<p class="p1"><span class="s1">        pattern: "You manage love like a room’s temperature.",</span></p>
<p class="p1"><span class="s1">        articulation: "You track the moods of others instinctively. Your safety is tied to the emotional weather of the people you love.",</span></p>
<p class="p1"><span class="s1">        context: "This hyper-vigilance was once a survival skill. Now, it prevents you from feeling your own internal climate.",</span></p>
<p class="p1"><span class="s1">        counsel: "Close your eyes. Ask: 'What is my temperature right now, regardless of theirs?'"</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">    ]</span></p>
<p class="p1"><span class="s1">  },</span></p>
<p class="p1"><span class="s1">  media: { </span></p>
<p class="p1"><span class="s1">    label: "House of Theatre",</span></p>
<p class="p1"><span class="s1">    analysis: "This House learns love through narrative and intensity. It seeks meaning in the 'spark' and treats emotional momentum as proof of destiny.",</span></p>
<p class="p1"><span class="s1">    slips: [</span></p>
<p class="p1"><span class="s1">      { // 0: The Shield</span></p>
<p class="p1"><span class="s1">        pattern: "You use intensity to avoid intimacy.",</span></p>
<p class="p1"><span class="s1">        articulation: "High drama feels safe because it is familiar. You chase the rush of the 'new' or the 'crisis' to avoid the vulnerability of the 'steady.'",</span></p>
<p class="p1"><span class="s1">        context: "Narratives compress time. Real intimacy is built in the boring moments that movies usually edit out.",</span></p>
<p class="p1"><span class="s1">        counsel: "Try a 'slow week.' Focus on the comfort of the routine rather than the thrill of the peak."</span></p>
<p class="p1"><span class="s1">      },</span></p>
<p class="p1"><span class="s1">      { // 1: The Armor</span></p>
<p class="p1"><span class="s1">        pattern: "You perform the 'Ideal Story.'",</span></p>
<p class="p1"><span class="s1">        articulation: "You try to make your relationship look like a masterpiece. You worry more about the arc of the story than the reality of the person.",</span></p>
<p class="p1"><span class="s1">        context: "Modern romance frames conflict as passion. This makes healthy, quiet growth feel like 'nothing is happening.'",</span></p>
<p class="p1"><span class="s1">        counsel: "Stop narrating. Ask: 'If no one ever saw this relationship, would I still want to be in it?'"</span></p>
<p class="p1"><span class="s1">      },</span></p>
<p class="p1"><span class="s1">      { // 2: The Pulse</span></p>
<p class="p1"><span class="s1">        pattern: "You confuse chemistry with compatibility.",</span></p>
<p class="p1"><span class="s1">        articulation: "You believe that if the feeling is big, the fit must be right. You ignore red flags if the 'vibe' matches your favorite story.",</span></p>
<p class="p1"><span class="s1">        context: "Adrenaline can look like destiny. But chemistry is a reaction; compatibility is a choice made daily.",</span></p>
<p class="p1"><span class="s1">        counsel: "Look for 'boring' green flags: reliability, kindness, and clear communication."</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">    ]</span></p>
<p class="p1"><span class="s1">  },</span></p>
<p class="p1"><span class="s1">  religion: { </span></p>
<p class="p1"><span class="s1">    label: "House of Meaning",</span></p>
<p class="p1"><span class="s1">    analysis: "This House treats love as a sacred practice and a moral duty. It values devotion but can struggle with the shame of being 'human.'",</span></p>
<p class="p1"><span class="s1">    slips: [</span></p>
<p class="p1"><span class="s1">      { // 0: The Shield</span></p>
<p class="p1"><span class="s1">        pattern: "You hide your 'bad' feelings to stay 'good.'",</span></p>
<p class="p1"><span class="s1">        articulation: "Because love is linked to your values, normal anger or doubt feels like a moral failure. You bury the 'dark' parts of yourself.",</span></p>
<p class="p1"><span class="s1">        context: "Shame-based belonging makes you a stranger to yourself. You cannot be fully loved if you are only partially seen.",</span></p>
<p class="p1"><span class="s1">        counsel: "Confess a 'small' doubt to a safe person. Practice being loved in your imperfection."</span></p>
<p class="p1"><span class="s1">      },</span></p>
<p class="p1"><span class="s1">      { // 1: The Armor</span></p>
<p class="p1"><span class="s1">        pattern: "You hold duty as a substitute for desire.",</span></p>
<p class="p1"><span class="s1">        articulation: "You do the right things so consistently that you forget to check if you actually want to be there. Commitment becomes an endurance test.",</span></p>
<p class="p1"><span class="s1">        context: "Ethics should support love, not replace it. Responsibility without joy leads to spiritual burnout.",</span></p>
<p class="p1"><span class="s1">        counsel: "Find one thing in your relationship that you do purely for pleasure, not because you 'should.'"</span></p>
<p class="p1"><span class="s1">      },</span></p>
<p class="p1"><span class="s1">      { // 2: The Pulse</span></p>
<p class="p1"><span class="s1">        pattern: "You fear disappointing the 'Ideal.'",</span></p>
<p class="p1"><span class="s1">        articulation: "You carry the weight of a community or a tradition. You feel you are representing something larger than yourself in your private life.",</span></p>
<p class="p1"><span class="s1">        context: "Navigating love across expectations is a heavy task. Your worth is not tied to how well you represent a standard.",</span></p>
<p class="p1"><span class="s1">        counsel: "Remind yourself: 'My love is allowed to be private, messy, and just for me.'"</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">    ]</span></p>
<p class="p1"><span class="s1">  },</span></p>
<p class="p1"><span class="s1">  school: { </span></p>
<p class="p1"><span class="s1">    label: "House of Measure",</span></p>
<p class="p1"><span class="s1">    analysis: "This House views love through the lens of achievement and comparison. It seeks certainty and fears the 'unmarked' path.",</span></p>
<p class="p1"><span class="s1">    slips: [</span></p>
<p class="p1"><span class="s1">      { // 0: The Shield</span></p>
<p class="p1"><span class="s1">        pattern: "You over-analyze signals to avoid risk.",</span></p>
<p class="p1"><span class="s1">        articulation: "You treat love like a syllabus. You look for 'proof' of safety so you don't have to take the leap of faith.",</span></p>
<p class="p1"><span class="s1">        context: "In high-pressure environments, uncertainty is expensive. In love, uncertainty is the only place growth happens.",</span></p>
<p class="p1"><span class="s1">        counsel: "Replace one 'investigation' with one direct question. Ask for what you want directly."</span></p>
<p class="p1"><span class="s1">      },</span></p>
<p class="p1"><span class="s1">      { // 1: The Armor</span></p>
<p class="p1"><span class="s1">        pattern: "You perform to be 'Top of Class.'",</span></p>
<p class="p1"><span class="s1">        articulation: "You try to be the perfect partner to ensure you aren't 'dropped.' You trade your authenticity for a high 'approval rating.'",</span></p>
<p class="p1"><span class="s1">        context: "When belonging is conditional, competence becomes a defense. You are trying to be too impressive to be rejected.",</span></p>
<p class="p1"><span class="s1">        counsel: "Purposefully do something 'wrong' or be uncool. See that you are still chosen when you aren't 'winning.'"</span></p>
<p class="p1"><span class="s1">      },</span></p>
<p class="p1"><span class="s1">      { // 2: The Pulse</span></p>
<p class="p1"><span class="s1">        pattern: "You feel behind an invisible timeline.",</span></p>
<p class="p1"><span class="s1">        articulation: "You compare your connection to milestones. You worry that if you aren't 'hitting targets,' you are failing at life.",</span></p>
<p class="p1"><span class="s1">        context: "Social hierarchies teach us to measure worth by speed. But love is a garden, not a race.",</span></p>
<p class="p1"><span class="s1">        counsel: "Delete the 'timeline.' Focus on the depth of the roots, not the height of the branches."</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">    ]</span></p>
<p class="p1"><span class="s1">  },</span></p>
<p class="p1"><span class="s1">  internet: { </span></p>
<p class="p1"><span class="s1">    label: "House of Distance",</span></p>
<p class="p1"><span class="s1">    analysis: "This House values autonomy and the power of 'the exit.' it protects dignity through detachment but often feels profoundly lonely.",</span></p>
<p class="p1"><span class="s1">    slips: [</span></p>
<p class="p1"><span class="s1">      { // 0: The Shield</span></p>
<p class="p1"><span class="s1">        pattern: "You leave first to protect your dignity.",</span></p>
<p class="p1"><span class="s1">        articulation: "You've learned that the person who cares less has the most power. You exit early so you are never the one left behind.",</span></p>
<p class="p1"><span class="s1">        context: "The attention economy rewards quick exits. But real intimacy requires staying through the 'cringe' and the 'boring.'",</span></p>
<p class="p1"><span class="s1">        counsel: "Try staying for one more conversation when you feel the urge to vanish. Lean into the awkwardness."</span></p>
<p class="p1"><span class="s1">      },</span></p>
<p class="p1"><span class="s1">      { // 1: The Armor</span></p>
<p class="p1"><span class="s1">        pattern: "You speak in 'hints' to stay safe.",</span></p>
<p class="p1"><span class="s1">        articulation: "You use signals, timing, and digital distance to test others. You want them to prove they care without you having to ask.",</span></p>
<p class="p1"><span class="s1">        context: "Directness feels like desperation to you. In reality, directness is the highest form of self-respect.",</span></p>
<p class="p1"><span class="s1">        counsel: "Send one 'un-curated' text. Say exactly what you feel without checking the 'vibe' first."</span></p>
<p class="p1"><span class="s1">      },</span></p>
<p class="p1"><span class="s1">      { // 2: The Pulse</span></p>
<p class="p1"><span class="s1">        pattern: "Your quiet feelings feel 'not enough.'",</span></p>
<p class="p1"><span class="s1">        articulation: "Because everything online is extreme, your steady, quiet love feels small. You doubt your own heart because it isn't 'loud.'",</span></p>
<p class="p1"><span class="s1">        context: "Real intimacy is low-resolution and private. It doesn't need to be performative to be powerful.",</span></p>
<p class="p1"><span class="s1">        counsel: "Trust your quietest emotions. They are often the truest ones."</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">    ]</span></p>
<p class="p1"><span class="s1">  }</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    const recognitionLines = [</span></p>
<p class="p1"><span class="s1">      "“Love is learned.”",</span></p>
<p class="p1"><span class="s1">      "“You are not bad at love.”",</span></p>
<p class="p1"><span class="s1">    ];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    const TRAITS = [</span></p>
<p class="p1"><span class="s1">      { id:"fast",  title:"I fall too fast.", sub:"speed • spark • rush", w:{ media:2, internet:1 } },</span></p>
<p class="p1"><span class="s1">      { id:"numb",  title:"I don’t feel enough.", sub:"muted • small • numb", w:{ internet:2, media:1 } },</span></p>
<p class="p1"><span class="s1">      { id:"leave", title:"I leave first.", sub:"exit • control • safety", w:{ internet:2, family:1 } },</span></p>
<p class="p1"><span class="s1">      { id:"guilt", title:"I feel guilty wanting more.", sub:"need • guilt • harmony", w:{ family:2, religion:1 } },</span></p>
<p class="p1"><span class="s1">      { id:"peace", title:"I prioritize peace over truth.", sub:"quiet • restraint • harmony", w:{ family:2, school:1 } },</span></p>
<p class="p1"><span class="s1">      { id:"think", title:"I overthink signals.", sub:"analysis • certainty • fear", w:{ school:2, media:1 } },</span></p>
<p class="p1"><span class="s1">      { id:"prove", title:"I perform to be chosen.", sub:"earn • impress • belong", w:{ school:2, family:1 } },</span></p>
<p class="p1"><span class="s1">      { id:"duty",  title:"I take love seriously.", sub:"meaning • devotion • care", w:{ religion:2, family:1 } }</span></p>
<p class="p1"><span class="s1">    ];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    const aTokenScreen = el("a-token-screen");</span></p>
<p class="p1"><span class="s1">    const aRecognitionScreen = el("a-recognition-screen");</span></p>
<p class="p1"><span class="s1">    const aTraitGrid = el("a-traitGrid");</span></p>
<p class="p1"><span class="s1">    const aTokenDots = el("a-tokenDots");</span></p>
<p class="p1"><span class="s1">    const aTokenStatus = el("a-tokenStatus");</span></p>
<p class="p1"><span class="s1">    const aTokenClearBtn = el("a-tokenClear");</span></p>
<p class="p1"><span class="s1">    const aBeginRecognitionBtn = el("a-beginRecognition");</span></p>
<p class="p1"><span class="s1">    const aBackToTokensBtn = el("a-backToTokens");</span></p>
<p class="p1"><span class="s1">    const aContinueToSlipBtn = el("a-continueToSlip");</span></p>
<p class="p1"><span class="s1">    const aRecognitionLineEl = el("a-recognitionLine");</span></p>
<p class="p1"><span class="s1">    const aCountdownTextEl = el("a-countdownText");</span></p>
<p class="p1"><span class="s1">    const aStepToken = el("a-stepToken");</span></p>
<p class="p1"><span class="s1">    const aStepRecognize = el("a-stepRecognize");</span></p>
<p class="p1"><span class="s1">    const aStepArticulate = el("a-stepArticulate");</span></p>
<p class="p1"><span class="s1">    const aStepCounsel = el("a-stepCounsel");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    let tokensTotal = 3;</span></p>
<p class="p1"><span class="s1">    let tokensLeft = 3;</span></p>
<p class="p1"><span class="s1">    let traitTokens = Object.fromEntries(TRAITS.map(t =&gt; [t.id, 0]));</span></p>
<p class="p1"><span class="s1">    let scores = { family:0, media:0, religion:0, school:0, internet:0 };</span></p>
<p class="p1"><span class="s1">    let primaryKey = null;</span></p>
<p class="p1"><span class="s1">    let secondaryKey = null;</span></p>
<p class="p1"><span class="s1">    let recognitionTimer = null;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function setStepA(active){</span></p>
<p class="p1"><span class="s1">      [aStepToken, aStepRecognize, aStepArticulate, aStepCounsel].forEach(s=&gt;s.classList.remove("active"));</span></p>
<p class="p1"><span class="s1">      if(active === "token") aStepToken.classList.add("active");</span></p>
<p class="p1"><span class="s1">      if(active === "recognition") aStepRecognize.classList.add("active");</span></p>
<p class="p1"><span class="s1">      if(active === "articulation") aStepArticulate.classList.add("active");</span></p>
<p class="p1"><span class="s1">      if(active === "counsel") aStepCounsel.classList.add("active");</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function renderTokenDotsA(){</span></p>
<p class="p1"><span class="s1">      aTokenDots.innerHTML = "";</span></p>
<p class="p1"><span class="s1">      for(let i=0;i&lt;tokensTotal;i++){</span></p>
<p class="p1"><span class="s1">        const d = document.createElement("span");</span></p>
<p class="p1"><span class="s1">        d.className = "dot" + (i &lt; tokensLeft ? " filled" : "");</span></p>
<p class="p1"><span class="s1">        aTokenDots.appendChild(d);</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function recomputeScoresA(){</span></p>
<p class="p1"><span class="s1">      scores = { family:0, media:0, religion:0, school:0, internet:0 };</span></p>
<p class="p1"><span class="s1">      for(const tr of TRAITS){</span></p>
<p class="p1"><span class="s1">        const c = traitTokens[tr.id] || 0;</span></p>
<p class="p1"><span class="s1">        if(c &lt;= 0) continue;</span></p>
<p class="p1"><span class="s1">        for(const k of Object.keys(tr.w)){</span></p>
<p class="p1"><span class="s1">          scores[k] += c * tr.w[k];</span></p>
<p class="p1"><span class="s1">        }</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">      const order = ["family","media","religion","school","internet"];</span></p>
<p class="p1"><span class="s1">      const arr = order.map(k =&gt; ({k, n: scores[k]}))</span></p>
<p class="p1"><span class="s1">        .sort((a,b)=&gt; b.n - a.n || order.indexOf(a.k) - order.indexOf(b.k));</span></p>
<p class="p1"><span class="s1">      primaryKey = arr[0].n &gt; 0 ? arr[0].k : null;</span></p>
<p class="p1"><span class="s1">      secondaryKey = arr[1].n &gt; 0 ? arr[1].k : null;</span></p>
<p class="p1"><span class="s1">      aBeginRecognitionBtn.disabled = (tokensLeft !== 0);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function deterministicSlipIndexA(forTeacherKey){</span></p>
<p class="p1"><span class="s1">      const w = { fast:3, numb:5, leave:7, guilt:11, peace:13, think:17, prove:19, duty:23 };</span></p>
<p class="p1"><span class="s1">      let h = 0;</span></p>
<p class="p1"><span class="s1">      for(const tr of TRAITS){</span></p>
<p class="p1"><span class="s1">        h += (traitTokens[tr.id] || 0) * w[tr.id];</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">      return h % teachers[forTeacherKey].slips.length;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function computeSealA(){</span></p>
<p class="p1"><span class="s1">      const w = { fast:31, numb:37, leave:41, guilt:43, peace:47, think:53, prove:59, duty:61 };</span></p>
<p class="p1"><span class="s1">      let n = 0;</span></p>
<p class="p1"><span class="s1">      for(const tr of TRAITS){</span></p>
<p class="p1"><span class="s1">        n += (traitTokens[tr.id] || 0) * w[tr.id];</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">      const seal = (n + 2026).toString(36).toUpperCase();</span></p>
<p class="p1"><span class="s1">      return "ISA-H2H-" + seal.padStart(4,"0");</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function renderTraitsA(){</span></p>
<p class="p1"><span class="s1">      aTraitGrid.innerHTML = "";</span></p>
<p class="p1"><span class="s1">      recomputeScoresA();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      TRAITS.forEach(tr=&gt;{</span></p>
<p class="p1"><span class="s1">        const count = traitTokens[tr.id] || 0;</span></p>
<p class="p1"><span class="s1">        const tile = document.createElement("div");</span></p>
<p class="p1"><span class="s1">        tile.className = "trait";</span></p>
<p class="p1"><span class="s1">        tile.tabIndex = 0;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        const slots = Array.from({length:3}).map((_,i)=&gt;</span></p>
<p class="p1"><span class="s1">          `&lt;span class="slot ${i &lt; count ? "on":""}"&gt;&lt;/span&gt;`</span></p>
<p class="p1"><span class="s1">        ).join("");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        tile.innerHTML = `</span></p>
<p class="p1"><span class="s1">          &lt;div class="trait-title"&gt;${tr.title}&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">          &lt;div class="trait-sub"&gt;${tr.sub}&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">          &lt;div class="trait-meter"&gt;</span></p>
<p class="p1"><span class="s1">            &lt;div class="trait-meter-label"&gt;Placed&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">            &lt;div class="token-slots" aria-label="Tokens placed"&gt;${slots}&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">          &lt;/div&gt;</span></p>
<p class="p1"><span class="s1">        `;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        const addOrRemoveToken = (mode = "auto")=&gt;{</span></p>
<p class="p1"><span class="s1">          const current = traitTokens[tr.id] || 0;</span></p>
<p class="p1"><span class="s1">          const wantRemove = (mode === "remove") || (mode === "auto" &amp;&amp; current &gt; 0);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">          if (wantRemove) {</span></p>
<p class="p1"><span class="s1">            if (current &lt;= 0) return;</span></p>
<p class="p1"><span class="s1">            traitTokens[tr.id] -= 1;</span></p>
<p class="p1"><span class="s1">            tokensLeft += 1;</span></p>
<p class="p1"><span class="s1">            renderTokenDotsA();</span></p>
<p class="p1"><span class="s1">            renderTraitsA();</span></p>
<p class="p1"><span class="s1">            softChime("gate");</span></p>
<p class="p1"><span class="s1">            aTokenStatus.textContent = `Token returned. ${tokensLeft} left.`;</span></p>
<p class="p1"><span class="s1">            return;</span></p>
<p class="p1"><span class="s1">          }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">          if(tokensLeft &lt;= 0){</span></p>
<p class="p1"><span class="s1">            aTokenStatus.textContent = "No tokens left. Return one token to move it.";</span></p>
<p class="p1"><span class="s1">            return;</span></p>
<p class="p1"><span class="s1">          }</span></p>
<p class="p1"><span class="s1">          if(current &gt;= 3) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">          traitTokens[tr.id] += 1;</span></p>
<p class="p1"><span class="s1">          tokensLeft -= 1;</span></p>
<p class="p1"><span class="s1">          renderTokenDotsA();</span></p>
<p class="p1"><span class="s1">          renderTraitsA();</span></p>
<p class="p1"><span class="s1">          softChime("place");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">          aTokenStatus.textContent = (tokensLeft &gt; 0)</span></p>
<p class="p1"><span class="s1">            ? `Token placed. ${tokensLeft} left.`</span></p>
<p class="p1"><span class="s1">            : `Allocation complete. Proceed to recognition.`;</span></p>
<p class="p1"><span class="s1">        };</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        tile.addEventListener("click", (e)=&gt;{</span></p>
<p class="p1"><span class="s1">          if (e.shiftKey) addOrRemoveToken("remove");</span></p>
<p class="p1"><span class="s1">          else addOrRemoveToken("auto");</span></p>
<p class="p1"><span class="s1">        });</span></p>
<p class="p1"><span class="s1">        tile.addEventListener("contextmenu", (e)=&gt;{</span></p>
<p class="p1"><span class="s1">          e.preventDefault();</span></p>
<p class="p1"><span class="s1">          addOrRemoveToken("remove");</span></p>
<p class="p1"><span class="s1">        });</span></p>
<p class="p1"><span class="s1">        tile.addEventListener("keydown", (e)=&gt;{</span></p>
<p class="p1"><span class="s1">          if(e.key === "Enter" || e.key === " "){</span></p>
<p class="p1"><span class="s1">            e.preventDefault();</span></p>
<p class="p1"><span class="s1">            addOrRemoveToken(e.shiftKey ? "remove" : "auto");</span></p>
<p class="p1"><span class="s1">          }</span></p>
<p class="p1"><span class="s1">        });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        // long press remove (mobile)</span></p>
<p class="p1"><span class="s1">        let pressTimer = null;</span></p>
<p class="p1"><span class="s1">        tile.addEventListener("touchstart", ()=&gt;{</span></p>
<p class="p1"><span class="s1">          pressTimer = setTimeout(()=&gt; addOrRemoveToken("remove"), 420);</span></p>
<p class="p1"><span class="s1">        }, { passive:true });</span></p>
<p class="p1"><span class="s1">        tile.addEventListener("touchend", ()=&gt;{ if(pressTimer) clearTimeout(pressTimer); pressTimer=null; }, { passive:true });</span></p>
<p class="p1"><span class="s1">        tile.addEventListener("touchmove", ()=&gt;{ if(pressTimer) clearTimeout(pressTimer); pressTimer=null; }, { passive:true });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        aTraitGrid.appendChild(tile);</span></p>
<p class="p1"><span class="s1">      });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      aTokenStatus.textContent = (tokensLeft &gt; 0)</span></p>
<p class="p1"><span class="s1">        ? "Spend all 3 tokens to continue."</span></p>
<p class="p1"><span class="s1">        : "Allocation complete. Proceed to recognition.";</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function clearTraitsA(){</span></p>
<p class="p1"><span class="s1">      traitTokens = Object.fromEntries(TRAITS.map(t =&gt; [t.id, 0]));</span></p>
<p class="p1"><span class="s1">      tokensLeft = tokensTotal;</span></p>
<p class="p1"><span class="s1">      primaryKey = null;</span></p>
<p class="p1"><span class="s1">      secondaryKey = null;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      aTokenStatus.textContent = "Cleared.";</span></p>
<p class="p1"><span class="s1">      renderTokenDotsA();</span></p>
<p class="p1"><span class="s1">      renderTraitsA();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      aBeginRecognitionBtn.disabled = true;</span></p>
<p class="p1"><span class="s1">      setStepA("token");</span></p>
<p class="p1"><span class="s1">      softChime("gate");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      el("a-result-screen").style.display = "none";</span></p>
<p class="p1"><span class="s1">      el("a-result-screen").style.opacity = "0";</span></p>
<p class="p1"><span class="s1">      aRecognitionScreen.style.display = "none";</span></p>
<p class="p1"><span class="s1">      aTokenScreen.style.display = "block";</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    aTokenClearBtn.addEventListener("click", clearTraitsA);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function startRecognitionA(){</span></p>
<p class="p1"><span class="s1">      if(tokensLeft !== 0){</span></p>
<p class="p1"><span class="s1">        aTokenStatus.textContent = "Please spend all tokens first.";</span></p>
<p class="p1"><span class="s1">        return;</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">      recomputeScoresA();</span></p>
<p class="p1"><span class="s1">      if(!primaryKey){</span></p>
<p class="p1"><span class="s1">        aTokenStatus.textContent = "Please select at least one trait.";</span></p>
<p class="p1"><span class="s1">        return;</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      setStepA("recognition");</span></p>
<p class="p1"><span class="s1">      aTokenScreen.style.display = "none";</span></p>
<p class="p1"><span class="s1">      aRecognitionScreen.style.display = "block";</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const idx = deterministicSlipIndexA(primaryKey) % recognitionLines.length;</span></p>
<p class="p1"><span class="s1">      aRecognitionLineEl.textContent = recognitionLines[idx];</span></p>
<p class="p1"><span class="s1">      softChime("gate");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      aContinueToSlipBtn.disabled = true;</span></p>
<p class="p1"><span class="s1">      aCountdownTextEl.textContent = "Continue unlocks in 3s";</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const start = performance.now();</span></p>
<p class="p1"><span class="s1">      const duration = 3000;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      if(recognitionTimer) cancelAnimationFrame(recognitionTimer);</span></p>
<p class="p1"><span class="s1">      const tick = (now)=&gt;{</span></p>
<p class="p1"><span class="s1">        const elapsed = now - start;</span></p>
<p class="p1"><span class="s1">        const remaining = Math.max(0, (duration - elapsed) / 1000);</span></p>
<p class="p1"><span class="s1">        if(remaining &gt; 0.01){</span></p>
<p class="p1"><span class="s1">          aCountdownTextEl.textContent = `Continue unlocks in ${Math.ceil(remaining)}s`;</span></p>
<p class="p1"><span class="s1">          recognitionTimer = requestAnimationFrame(tick);</span></p>
<p class="p1"><span class="s1">        } else {</span></p>
<p class="p1"><span class="s1">          aCountdownTextEl.textContent = "Ready.";</span></p>
<p class="p1"><span class="s1">          aContinueToSlipBtn.disabled = false;</span></p>
<p class="p1"><span class="s1">        }</span></p>
<p class="p1"><span class="s1">      };</span></p>
<p class="p1"><span class="s1">      recognitionTimer = requestAnimationFrame(tick);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    aBeginRecognitionBtn.addEventListener("click", startRecognitionA);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    aBackToTokensBtn.addEventListener("click", ()=&gt;{</span></p>
<p class="p1"><span class="s1">      if(recognitionTimer) cancelAnimationFrame(recognitionTimer);</span></p>
<p class="p1"><span class="s1">      aRecognitionScreen.style.display = "none";</span></p>
<p class="p1"><span class="s1">      aTokenScreen.style.display = "block";</span></p>
<p class="p1"><span class="s1">      setStepA("token");</span></p>
<p class="p1"><span class="s1">      softChime("place");</span></p>
<p class="p1"><span class="s1">    });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function showSlipA(){</span></p>
<p class="p1"><span class="s1">      recomputeScoresA();</span></p>
<p class="p1"><span class="s1">      if(!primaryKey) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const i = deterministicSlipIndexA(primaryKey);</span></p>
<p class="p1"><span class="s1">      const slip = teachers[primaryKey].slips[i];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      Ritual.primaryKey = primaryKey;</span></p>
<p class="p1"><span class="s1">      Ritual.secondaryKey = secondaryKey;</span></p>
<p class="p1"><span class="s1">      Ritual.seal = computeSealA();</span></p>
<p class="p1"><span class="s1">      Ritual.counsel = slip.counsel;</span></p>
<p class="p1"><span class="s1">      Ritual.pattern = slip.pattern;</span></p>
<p class="p1"><span class="s1">      Ritual.slip = slip;</span></p>
<p class="p1"><span class="s1">      Ritual.traitTokens = { ...traitTokens };</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      setStepA("articulation");</span></p>
<p class="p1"><span class="s1">      aRecognitionScreen.style.display = "none";</span></p>
<p class="p1"><span class="s1">      aTokenScreen.style.display = "none";</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const result = el("a-result-screen");</span></p>
<p class="p1"><span class="s1">      result.style.display = "block";</span></p>
<p class="p1"><span class="s1">      requestAnimationFrame(()=&gt; result.style.opacity = "1");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      el("a-pill-primary").textContent = `House: ${teachers[primaryKey].label}`;</span></p>
<p class="p1"><span class="s1">      el("a-pill-secondary").textContent = `Secondary: ${secondaryKey ? teachers[secondaryKey].label : "—"}`;</span></p>
<p class="p1"><span class="s1">      el("a-seal").textContent = `Seal: ${Ritual.seal}`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      el("a-frontLine").textContent = slip.pattern;</span></p>
<p class="p1"><span class="s1">      el("a-articulationText").textContent = slip.articulation;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      el("a-houseText").textContent =</span></p>
<p class="p1"><span class="s1">        teachers[primaryKey].analysis +</span></p>
<p class="p1"><span class="s1">        (secondaryKey ? ` A secondary influence from ${teachers[secondaryKey].label} may color how this shows up.` : "");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      el("a-contextText").textContent = slip.context;</span></p>
<p class="p1"><span class="s1">      el("a-counselText").textContent = slip.counsel;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      softChime("reveal");</span></p>
<p class="p1"><span class="s1">      setTimeout(()=&gt; setStepA("counsel"), 800);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    aContinueToSlipBtn.addEventListener("click", showSlipA);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    el("a-saveBtn").addEventListener("click", async ()=&gt;{</span></p>
<p class="p1"><span class="s1">      await exportElementAsPNG(el("a-capture-frame"), "HeartToHeart_ISA_ReflectionSlip.png");</span></p>
<p class="p1"><span class="s1">    });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    el("a-resetBtn").addEventListener("click", clearTraitsA);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    renderTokenDotsA();</span></p>
<p class="p1"><span class="s1">    renderTraitsA();</span></p>
<p class="p1"><span class="s1">    setStepA("token");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       EXPERIENCE B DATA</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    const colorPalette = [</span></p>
<p class="p1"><span class="s1">      { name:"Ivory Silk", hex:"#fffdf0", quote:"To love at all is to be vulnerable.", source:"C.S. Lewis", movie:"Shadowlands", book:"The Four Loves" },</span></p>
<p class="p1"><span class="s1">      { name:"Vintage Champagne", hex:"#f5ead0", quote:"Love is not blind; it sees more, not less.", source:"Erich Fromm", movie:"In the Mood for Love", book:"The Art of Loving" },</span></p>
<p class="p1"><span class="s1">      { name:"Tudor Rose", hex:"#fce3e3", quote:"Everything that frightens us is something helpless that wants our love.", source:"Rainer Maria Rilke", movie:"The Shape of Water", book:"Letters to a Young Poet" },</span></p>
<p class="p1"><span class="s1">      { name:"English Lavender", hex:"#e8e1f5", quote:"It is not necessary to hurry intimacy.", source:"Anne Carson", movie:"Before Sunset", book:"Eros the Bittersweet" },</span></p>
<p class="p1"><span class="s1">      { name:"Versailles Sage", hex:"#e2ede4", quote:"The world is full of magic things, patiently waiting for our senses to grow sharper.", source:"W.B. Yeats", movie:"Song of the Sea", book:"The Wind Among the Reeds" },</span></p>
<p class="p1"><span class="s1">      { name:"Gilded Moss", hex:"#ecebbd", quote:"The only way to make sense out of change is to plunge into it.", source:"Alan Watts", movie:"Spring, Summer, Fall, Winter... and Spring", book:"The Wisdom of Insecurity" },</span></p>
<p class="p1"><span class="s1">      { name:"Biedermeier Blue", hex:"#e0f0f5", quote:"Loneliness is the poverty of self; solitude is the richness of self.", source:"May Sarton", movie:"Lost in Translation", book:"Journal of a Solitude" },</span></p>
<p class="p1"><span class="s1">      { name:"Old Manor Taupe", hex:"#ede6e1", quote:"Acceptance is a small, quiet room.", source:"Cheryl Strayed", movie:"Nomadland", book:"Tiny Beautiful Things" },</span></p>
<p class="p1"><span class="s1">      { name:"Terracotta Sundial", hex:"#f5e6d3", quote:"Beauty is in things imperfect, impermanent, and incomplete.", source:"Leonard Koren", movie:"Arrietty", book:"Wabi-Sabi for Artists, Designers, Poets &amp; Philosophers" },</span></p>
<p class="p1"><span class="s1">      { name:"Slate Manor", hex:"#e1e6e8", quote:"Love is the extremely difficult realization that something other than oneself is real.", source:"Iris Murdoch", movie:"Eternal Sunshine of the Spotless Mind", book:"The Sovereignty of Good" },</span></p>
<p class="p1"><span class="s1">      { name:"Linen Prayer", hex:"#fcfaf7", quote:"Love is not a relationship between one person and another, but a relationship between a person and love itself.", source:"Søren Kierkegaard", movie:"Still Walking", book:"Works of Love" },</span></p>
<p class="p1"><span class="s1">      { name:"Orchard Ash", hex:"#f0f0f0", quote:"Love, by its very nature, is unworldly.", source:"Hannah Arendt", movie:"A Hidden Life", book:"The Human Condition" },</span></p>
<p class="p1"><span class="s1">      { name:"Cemetery Stone", hex:"#f3f2f1", quote:"To be alone is to be with the world without intermediaries.", source:"Maurice Blanchot", movie:"Taste of Cherry", book:"The Space of Literature" },</span></p>
<p class="p1"><span class="s1">      { name:"Pale Concrete", hex:"#f6f5f2", quote:"Nothing is missing. Something is simply not added.", source:"Gilles Deleuze", movie:"Columbus", book:"Negotiations" },</span></p>
<p class="p1"><span class="s1">      { name:"Oat Chapel", hex:"#f3eddc", quote:"Love is an act of faith, and whoever is of little faith is also of little love.", source:"Erich Fromm", movie:"Ordet", book:"The Art of Loving" },</span></p>
<p class="p1"><span class="s1">      { name:"Ash Rose", hex:"#f2eaea", quote:"Grief is the final manifestation of love.", source:"Joan Didion", movie:"Aftersun", book:"Blue Nights" }</span></p>
<p class="p1"><span class="s1">    ];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    const HOUSE_PALETTE = {</span></p>
<p class="p1"><span class="s1">      family:   ["Ivory Silk","Vintage Champagne","Old Manor Taupe","Oat Chapel","Linen Prayer","Ash Rose","Versailles Sage","Gilded Moss"],</span></p>
<p class="p1"><span class="s1">      religion: ["Linen Prayer","Oat Chapel","Ivory Silk","Vintage Champagne","Old Manor Taupe","Versailles Sage"],</span></p>
<p class="p1"><span class="s1">      media:    ["Tudor Rose","English Lavender","Biedermeier Blue","Slate Manor","Ash Rose"],</span></p>
<p class="p1"><span class="s1">      internet: ["Slate Manor","Cemetery Stone","Pale Concrete","Orchard Ash","Biedermeier Blue"],</span></p>
<p class="p1"><span class="s1">      school:   ["Slate Manor","Linen Prayer","Old Manor Taupe","Terracotta Sundial","Biedermeier Blue","Vintage Champagne"]</span></p>
<p class="p1"><span class="s1">    };</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    const TRAIT_BIAS = {</span></p>
<p class="p1"><span class="s1">      fast:   ["English Lavender","Tudor Rose"],</span></p>
<p class="p1"><span class="s1">      numb:   ["Cemetery Stone","Pale Concrete"],</span></p>
<p class="p1"><span class="s1">      leave:  ["Slate Manor","Orchard Ash"],</span></p>
<p class="p1"><span class="s1">      guilt:  ["Oat Chapel","Linen Prayer"],</span></p>
<p class="p1"><span class="s1">      peace:  ["Old Manor Taupe","Vintage Champagne"],</span></p>
<p class="p1"><span class="s1">      think:  ["Slate Manor","Biedermeier Blue"],</span></p>
<p class="p1"><span class="s1">      prove:  ["Terracotta Sundial","Vintage Champagne"],</span></p>
<p class="p1"><span class="s1">      duty:   ["Linen Prayer","Versailles Sage"],</span></p>
<p class="p1"><span class="s1">    };</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function getTopTraitsA(limit = 2){</span></p>
<p class="p1"><span class="s1">      if(!Ritual.traitTokens) return [];</span></p>
<p class="p1"><span class="s1">      return Object.entries(Ritual.traitTokens)</span></p>
<p class="p1"><span class="s1">        .filter(([,c])=&gt;c&gt;0)</span></p>
<p class="p1"><span class="s1">        .sort((a,b)=&gt;b[1]-a[1])</span></p>
<p class="p1"><span class="s1">        .slice(0,limit)</span></p>
<p class="p1"><span class="s1">        .map(([id])=&gt;id);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function pickFromHousePool(){</span></p>
<p class="p1"><span class="s1">      const hk = getHouseKeyForB();</span></p>
<p class="p1"><span class="s1">      const houseNames = HOUSE_PALETTE[hk] || HOUSE_PALETTE.family;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const topTraits = getTopTraitsA(2);</span></p>
<p class="p1"><span class="s1">      const traitNames = topTraits.flatMap(tid =&gt; TRAIT_BIAS[tid] || []);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const combined = [...new Set([...traitNames, ...houseNames])];</span></p>
<p class="p1"><span class="s1">      const pool = colorPalette.filter(c =&gt; combined.includes(c.name));</span></p>
<p class="p1"><span class="s1">      const chooseFrom = pool.length ? pool : colorPalette;</span></p>
<p class="p1"><span class="s1">      return chooseFrom[Math.floor(Math.random() * chooseFrom.length)];</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       EXPERIENCE B LOGIC (deck + reveal)</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    const deckB = el('b-deck-container');</span></p>
<p class="p1"><span class="s1">    const statusB = el('b-status-text');</span></p>
<p class="p1"><span class="s1">    let shuffleStateB = 0;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function createDeckB() {</span></p>
<p class="p1"><span class="s1">      deckB.innerHTML = "";</span></p>
<p class="p1"><span class="s1">      const crest = getStyleForB().crest;</span></p>
<p class="p1"><span class="s1">      for (let i = 0; i &lt; 12; i++) {</span></p>
<p class="p1"><span class="s1">        const card = document.createElement('div');</span></p>
<p class="p1"><span class="s1">        card.className = 'card';</span></p>
<p class="p1"><span class="s1">        card.style.zIndex = i;</span></p>
<p class="p1"><span class="s1">        card.innerHTML = `&lt;div class="card-crest"&gt;${crest}&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1">        card.style.transform = `translate(${i * 0.5}px, ${i * 0.5}px)`;</span></p>
<p class="p1"><span class="s1">        card.onclick = () =&gt; {</span></p>
<p class="p1"><span class="s1">          if (shuffleStateB &lt; 3) runShuffleB();</span></p>
<p class="p1"><span class="s1">          else if (shuffleStateB === 4) revealCardB();</span></p>
<p class="p1"><span class="s1">        };</span></p>
<p class="p1"><span class="s1">        deckB.appendChild(card);</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function runShuffleB() {</span></p>
<p class="p1"><span class="s1">      shuffleStateB++;</span></p>
<p class="p1"><span class="s1">      const cards = deckB.querySelectorAll('.card');</span></p>
<p class="p1"><span class="s1">      cards.forEach((card) =&gt; {</span></p>
<p class="p1"><span class="s1">        const rx = (Math.random() - 0.5) * 380;</span></p>
<p class="p1"><span class="s1">        const ry = (Math.random() - 0.5) * 320;</span></p>
<p class="p1"><span class="s1">        const rr = (Math.random() - 0.5) * 90;</span></p>
<p class="p1"><span class="s1">        card.style.transform = `translate(${rx}px, ${ry}px) rotate(${rr}deg)`;</span></p>
<p class="p1"><span class="s1">      });</span></p>
<p class="p1"><span class="s1">      statusB.innerText = `Shuffling Intentions... (${shuffleStateB}/3)`;</span></p>
<p class="p1"><span class="s1">      setTimeout(() =&gt; {</span></p>
<p class="p1"><span class="s1">        cards.forEach((card, i) =&gt; card.style.transform = `translate(${i * 0.3}px, ${i * 0.3}px) rotate(0deg)`);</span></p>
<p class="p1"><span class="s1">        if (shuffleStateB === 3) setTimeout(fanCardsB, 600);</span></p>
<p class="p1"><span class="s1">      }, 800);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function fanCardsB() {</span></p>
<p class="p1"><span class="s1">      const cards = deckB.querySelectorAll('.card');</span></p>
<p class="p1"><span class="s1">      shuffleStateB = 4;</span></p>
<p class="p1"><span class="s1">      statusB.innerText = "Draw your heart's secret";</span></p>
<p class="p1"><span class="s1">      const windowWidth = window.innerWidth;</span></p>
<p class="p1"><span class="s1">      let spread, angleStep;</span></p>
<p class="p1"><span class="s1">      if (windowWidth &lt; 480) { spread = 22; angleStep = 5; }</span></p>
<p class="p1"><span class="s1">      else if (windowWidth &lt; 1024) { spread = 35; angleStep = 7; }</span></p>
<p class="p1"><span class="s1">      else { spread = 45; angleStep = 9; }</span></p>
<p class="p1"><span class="s1">      cards.forEach((card, i) =&gt; {</span></p>
<p class="p1"><span class="s1">        const centerOffset = (cards.length - 1) / 2;</span></p>
<p class="p1"><span class="s1">        const angle = (i - centerOffset) * angleStep;</span></p>
<p class="p1"><span class="s1">        const x = (i - centerOffset) * spread;</span></p>
<p class="p1"><span class="s1">        const y = windowWidth &lt; 480 ? 10 : 20;</span></p>
<p class="p1"><span class="s1">        card.style.transform = `translate(${x}px, ${y}px) rotate(${angle}deg)`;</span></p>
<p class="p1"><span class="s1">      });</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function revealCardB() {</span></p>
<p class="p1"><span class="s1">      const data = pickFromHousePool();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      el('b-ritual-screen').style.opacity = '0';</span></p>
<p class="p1"><span class="s1">      applyHouseMoodToGarden();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      el("b-caption").textContent = Ritual.counsel ? Ritual.counsel : "Take what resonates. Leave what doesn’t.";</span></p>
<p class="p1"><span class="s1">      el("b-seal").textContent = `Under this seal · ${getShortSeal()}`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      document.body.style.backgroundColor = data.hex;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      if(audioPrimed) setPianoMood("B");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      setTimeout(() =&gt; {</span></p>
<p class="p1"><span class="s1">        el('b-ritual-screen').style.display = 'none';</span></p>
<p class="p1"><span class="s1">        el('b-result-screen').style.display = 'block';</span></p>
<p class="p1"><span class="s1">        el('b-quote-text').innerText = data.quote;</span></p>
<p class="p1"><span class="s1">        el('b-quote-source').innerText = `— ${data.source}`;</span></p>
<p class="p1"><span class="s1">        el('b-movie-title').innerText = data.movie;</span></p>
<p class="p1"><span class="s1">        el('b-book-title').innerText = data.book;</span></p>
<p class="p1"><span class="s1">        setTimeout(() =&gt; { el('b-result-screen').style.opacity = '1'; }, 60);</span></p>
<p class="p1"><span class="s1">      }, 900);</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    el("b-saveBtn").addEventListener("click", async ()=&gt;{</span></p>
<p class="p1"><span class="s1">      await exportElementAsPNG(el("b-capture-frame"), "HeartToHeart_ISA.png");</span></p>
<p class="p1"><span class="s1">    });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    el("b-resetBtn").addEventListener("click", ()=&gt;{</span></p>
<p class="p1"><span class="s1">      shuffleStateB = 0;</span></p>
<p class="p1"><span class="s1">      el("b-result-screen").style.display = "none";</span></p>
<p class="p1"><span class="s1">      el("b-result-screen").style.opacity = "0";</span></p>
<p class="p1"><span class="s1">      el("b-ritual-screen").style.display = "block";</span></p>
<p class="p1"><span class="s1">      el("b-ritual-screen").style.opacity = "1";</span></p>
<p class="p1"><span class="s1">      document.body.style.backgroundColor = "#FFFEFA";</span></p>
<p class="p1"><span class="s1">      statusB.innerText = "Tap the deck to begin";</span></p>
<p class="p1"><span class="s1">      createDeckB();</span></p>
<p class="p1"><span class="s1">      stickersB.length = 0;</span></p>
<p class="p1"><span class="s1">      decorLayerB.innerHTML = "";</span></p>
<p class="p1"><span class="s1">      applyHouseMoodToGarden();</span></p>
<p class="p1"><span class="s1">      if(audioPrimed) setPianoMood("A");</span></p>
<p class="p1"><span class="s1">    });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    createDeckB();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    /* =========================</span></p>
<p class="p1"><span class="s1">       B Mode + Photo + Stickers</span></p>
<p class="p1"><span class="s1">       ========================= */</span></p>
<p class="p1"><span class="s1">    const cardCanvasB = el("b-cardCanvas");</span></p>
<p class="p1"><span class="s1">    const decorLayerB = el("b-decorLayer");</span></p>
<p class="p1"><span class="s1">    const userPhotoB = el("b-userPhoto");</span></p>
<p class="p1"><span class="s1">    const modeSelectB = el("b-modeSelect");</span></p>
<p class="p1"><span class="s1">    const photoInputB = el("b-photoInput");</span></p>
<p class="p1"><span class="s1">    const photoInputWrapB = el("b-photoInputWrap");</span></p>
<p class="p1"><span class="s1">    const stickerSelectB = el("b-stickerSelect");</span></p>
<p class="p1"><span class="s1">    const stickerSizeB = el("b-stickerSize");</span></p>
<p class="p1"><span class="s1">    const placeStickerBtnB = el("b-placeStickerBtn");</span></p>
<p class="p1"><span class="s1">    const clearStickersBtnB = el("b-clearStickersBtn");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    const stickersB = [];</span></p>
<p class="p1"><span class="s1">    let activeStickerIdB = null;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function setActiveStickerB(id) {</span></p>
<p class="p1"><span class="s1">      activeStickerIdB = id;</span></p>
<p class="p1"><span class="s1">      decorLayerB.querySelectorAll(".sticker").forEach(elm =&gt; {</span></p>
<p class="p1"><span class="s1">        elm.style.outline = (elm.dataset.id === id) ? "1px dashed rgba(212,175,55,0.55)" : "none";</span></p>
<p class="p1"><span class="s1">        elm.style.outlineOffset = "6px";</span></p>
<p class="p1"><span class="s1">      });</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function setModeB(mode) {</span></p>
<p class="p1"><span class="s1">      const isHybrid = mode === "hybrid";</span></p>
<p class="p1"><span class="s1">      cardCanvasB.dataset.mode = mode;</span></p>
<p class="p1"><span class="s1">      photoInputWrapB.style.display = isHybrid ? "inline-flex" : "none";</span></p>
<p class="p1"><span class="s1">      if (!isHybrid) {</span></p>
<p class="p1"><span class="s1">        userPhotoB.removeAttribute("src");</span></p>
<p class="p1"><span class="s1">        userPhotoB.style.display = "none";</span></p>
<p class="p1"><span class="s1">        photoInputB.value = "";</span></p>
<p class="p1"><span class="s1">      } else {</span></p>
<p class="p1"><span class="s1">        userPhotoB.style.display = userPhotoB.src ? "block" : "none";</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    modeSelectB.addEventListener("change", (e) =&gt; setModeB(e.target.value));</span></p>
<p class="p1"><span class="s1">    setModeB(modeSelectB.value);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    photoInputB.addEventListener("change", (e) =&gt; {</span></p>
<p class="p1"><span class="s1">      const file = e.target.files &amp;&amp; e.target.files[0];</span></p>
<p class="p1"><span class="s1">      if (!file) return;</span></p>
<p class="p1"><span class="s1">      userPhotoB.src = URL.createObjectURL(file);</span></p>
<p class="p1"><span class="s1">      userPhotoB.style.display = "block";</span></p>
<p class="p1"><span class="s1">    });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function clampToCanvasB(x, y, elNode) {</span></p>
<p class="p1"><span class="s1">      const host = decorLayerB.getBoundingClientRect();</span></p>
<p class="p1"><span class="s1">      const rect = elNode.getBoundingClientRect();</span></p>
<p class="p1"><span class="s1">      const halfW = rect.width / 2;</span></p>
<p class="p1"><span class="s1">      const halfH = rect.height / 2;</span></p>
<p class="p1"><span class="s1">      return {</span></p>
<p class="p1"><span class="s1">        x: Math.max(halfW, Math.min(host.width - halfW, x)),</span></p>
<p class="p1"><span class="s1">        y: Math.max(halfH, Math.min(host.height - halfH, y)),</span></p>
<p class="p1"><span class="s1">      };</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function removeStickerB(id) {</span></p>
<p class="p1"><span class="s1">      const idx = stickersB.findIndex((s) =&gt; s.id === id);</span></p>
<p class="p1"><span class="s1">      if (idx !== -1) stickersB.splice(idx, 1);</span></p>
<p class="p1"><span class="s1">      const elNode = decorLayerB.querySelector(`[data-id="${id}"]`);</span></p>
<p class="p1"><span class="s1">      if (elNode) elNode.remove();</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function applyTransformB(elNode, s) {</span></p>
<p class="p1"><span class="s1">      elNode.style.transform = `translate(-50%,-50%) rotate(${s.rot}deg) scale(${s.scale})`;</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function makeTransformableB(elNode, s) {</span></p>
<p class="p1"><span class="s1">      let dragging = false;</span></p>
<p class="p1"><span class="s1">      let rotateMode = false;</span></p>
<p class="p1"><span class="s1">      let scaleMode = false;</span></p>
<p class="p1"><span class="s1">      let startAngle = 0;</span></p>
<p class="p1"><span class="s1">      let startRot = 0;</span></p>
<p class="p1"><span class="s1">      let startY = 0;</span></p>
<p class="p1"><span class="s1">      let startScale = 1;</span></p>
<p class="p1"><span class="s1">      let gestureActive = false;</span></p>
<p class="p1"><span class="s1">      let startDist = 0;</span></p>
<p class="p1"><span class="s1">      let startGestureAngle = 0;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const getCenter = () =&gt; {</span></p>
<p class="p1"><span class="s1">        const r = elNode.getBoundingClientRect();</span></p>
<p class="p1"><span class="s1">        return { cx: r.left + r.width / 2, cy: r.top + r.height / 2 };</span></p>
<p class="p1"><span class="s1">      };</span></p>
<p class="p1"><span class="s1">      const angleBetween = (p1, p2) =&gt;</span></p>
<p class="p1"><span class="s1">        Math.atan2(p2.y - p1.y, p2.x - p1.x) * (180 / Math.PI);</span></p>
<p class="p1"><span class="s1">      const distBetween = (p1, p2) =&gt; Math.hypot(p2.x - p1.x, p2.y - p1.y);</span></p>
<p class="p1"><span class="s1">      const clampScale = (v) =&gt; Math.max(0.35, Math.min(3.2, v));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      function onDown(e) {</span></p>
<p class="p1"><span class="s1">        e.preventDefault();</span></p>
<p class="p1"><span class="s1">        e.stopPropagation();</span></p>
<p class="p1"><span class="s1">        elNode.setPointerCapture?.(e.pointerId);</span></p>
<p class="p1"><span class="s1">        setActiveStickerB(s.id);</span></p>
<p class="p1"><span class="s1">        dragging = true;</span></p>
<p class="p1"><span class="s1">        rotateMode = e.altKey === true;</span></p>
<p class="p1"><span class="s1">        scaleMode = e.shiftKey === true;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        if (rotateMode) {</span></p>
<p class="p1"><span class="s1">          const { cx, cy } = getCenter();</span></p>
<p class="p1"><span class="s1">          startAngle = angleBetween({ x: cx, y: cy }, { x: e.clientX, y: e.clientY });</span></p>
<p class="p1"><span class="s1">          startRot = s.rot;</span></p>
<p class="p1"><span class="s1">        }</span></p>
<p class="p1"><span class="s1">        if (scaleMode) {</span></p>
<p class="p1"><span class="s1">          startY = e.clientY;</span></p>
<p class="p1"><span class="s1">          startScale = s.scale;</span></p>
<p class="p1"><span class="s1">        }</span></p>
<p class="p1"><span class="s1">        elNode.style.cursor = "grabbing";</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      function onMove(e) {</span></p>
<p class="p1"><span class="s1">        if (!dragging) return;</span></p>
<p class="p1"><span class="s1">        const host = decorLayerB.getBoundingClientRect();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        if (scaleMode) {</span></p>
<p class="p1"><span class="s1">          const dy = (startY - e.clientY);</span></p>
<p class="p1"><span class="s1">          const factor = 1 + (dy / 220);</span></p>
<p class="p1"><span class="s1">          s.scale = clampScale(startScale * factor);</span></p>
<p class="p1"><span class="s1">          applyTransformB(elNode, s);</span></p>
<p class="p1"><span class="s1">          return;</span></p>
<p class="p1"><span class="s1">        }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        if (rotateMode) {</span></p>
<p class="p1"><span class="s1">          const { cx, cy } = getCenter();</span></p>
<p class="p1"><span class="s1">          const a = angleBetween({ x: cx, y: cy }, { x: e.clientX, y: e.clientY });</span></p>
<p class="p1"><span class="s1">          s.rot = startRot + (a - startAngle);</span></p>
<p class="p1"><span class="s1">          applyTransformB(elNode, s);</span></p>
<p class="p1"><span class="s1">          return;</span></p>
<p class="p1"><span class="s1">        }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">        const x = e.clientX - host.left;</span></p>
<p class="p1"><span class="s1">        const y = e.clientY - host.top;</span></p>
<p class="p1"><span class="s1">        const clamped = clampToCanvasB(x, y, elNode);</span></p>
<p class="p1"><span class="s1">        elNode.style.left = clamped.x + "px";</span></p>
<p class="p1"><span class="s1">        elNode.style.top = clamped.y + "px";</span></p>
<p class="p1"><span class="s1">        s.xPct = clamped.x / host.width;</span></p>
<p class="p1"><span class="s1">        s.yPct = clamped.y / host.height;</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      function onUp(e) {</span></p>
<p class="p1"><span class="s1">        dragging = false;</span></p>
<p class="p1"><span class="s1">        rotateMode = false;</span></p>
<p class="p1"><span class="s1">        scaleMode = false;</span></p>
<p class="p1"><span class="s1">        elNode.releasePointerCapture?.(e.pointerId);</span></p>
<p class="p1"><span class="s1">        elNode.style.cursor = "grab";</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      function onWheel(e) {</span></p>
<p class="p1"><span class="s1">        e.preventDefault();</span></p>
<p class="p1"><span class="s1">        e.stopPropagation();</span></p>
<p class="p1"><span class="s1">        setActiveStickerB(s.id);</span></p>
<p class="p1"><span class="s1">        const delta = -e.deltaY;</span></p>
<p class="p1"><span class="s1">        const step = delta &gt; 0 ? 1.08 : 0.92;</span></p>
<p class="p1"><span class="s1">        s.scale = clampScale(s.scale * step);</span></p>
<p class="p1"><span class="s1">        applyTransformB(elNode, s);</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      function onTouchStart(e) {</span></p>
<p class="p1"><span class="s1">        if (e.touches.length === 2) {</span></p>
<p class="p1"><span class="s1">          e.preventDefault();</span></p>
<p class="p1"><span class="s1">          e.stopPropagation();</span></p>
<p class="p1"><span class="s1">          setActiveStickerB(s.id);</span></p>
<p class="p1"><span class="s1">          gestureActive = true;</span></p>
<p class="p1"><span class="s1">          const p1 = { x: e.touches[0].clientX, y: e.touches[0].clientY };</span></p>
<p class="p1"><span class="s1">          const p2 = { x: e.touches[1].clientX, y: e.touches[1].clientY };</span></p>
<p class="p1"><span class="s1">          startDist = distBetween(p1, p2);</span></p>
<p class="p1"><span class="s1">          startGestureAngle = angleBetween(p1, p2);</span></p>
<p class="p1"><span class="s1">          startScale = s.scale;</span></p>
<p class="p1"><span class="s1">          startRot = s.rot;</span></p>
<p class="p1"><span class="s1">        }</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      function onTouchMove(e) {</span></p>
<p class="p1"><span class="s1">        if (!gestureActive || e.touches.length !== 2) return;</span></p>
<p class="p1"><span class="s1">        e.preventDefault();</span></p>
<p class="p1"><span class="s1">        const p1 = { x: e.touches[0].clientX, y: e.touches[0].clientY };</span></p>
<p class="p1"><span class="s1">        const p2 = { x: e.touches[1].clientX, y: e.touches[1].clientY };</span></p>
<p class="p1"><span class="s1">        const d = distBetween(p1, p2);</span></p>
<p class="p1"><span class="s1">        const a = angleBetween(p1, p2);</span></p>
<p class="p1"><span class="s1">        const ratio = d / Math.max(1, startDist);</span></p>
<p class="p1"><span class="s1">        s.scale = clampScale(startScale * ratio);</span></p>
<p class="p1"><span class="s1">        s.rot = startRot + (a - startGestureAngle);</span></p>
<p class="p1"><span class="s1">        applyTransformB(elNode, s);</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      function onTouchEnd(e) {</span></p>
<p class="p1"><span class="s1">        if (e.touches.length &lt; 2) gestureActive = false;</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      elNode.addEventListener("pointerdown", onDown);</span></p>
<p class="p1"><span class="s1">      window.addEventListener("pointermove", onMove);</span></p>
<p class="p1"><span class="s1">      window.addEventListener("pointerup", onUp);</span></p>
<p class="p1"><span class="s1">      elNode.addEventListener("wheel", onWheel, { passive: false });</span></p>
<p class="p1"><span class="s1">      elNode.addEventListener("touchstart", onTouchStart, { passive: false });</span></p>
<p class="p1"><span class="s1">      elNode.addEventListener("touchmove", onTouchMove, { passive: false });</span></p>
<p class="p1"><span class="s1">      elNode.addEventListener("touchend", onTouchEnd, { passive: true });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      elNode.addEventListener("dblclick", (e) =&gt; {</span></p>
<p class="p1"><span class="s1">        e.preventDefault();</span></p>
<p class="p1"><span class="s1">        e.stopPropagation();</span></p>
<p class="p1"><span class="s1">        removeStickerB(s.id);</span></p>
<p class="p1"><span class="s1">        if (activeStickerIdB === s.id) activeStickerIdB = null;</span></p>
<p class="p1"><span class="s1">      });</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function createStickerB(symbol) {</span></p>
<p class="p1"><span class="s1">      const host = decorLayerB.getBoundingClientRect();</span></p>
<p class="p1"><span class="s1">      const id = "st_" + Math.random().toString(16).slice(2);</span></p>
<p class="p1"><span class="s1">      const baseSize = Number(stickerSizeB.value || 34);</span></p>
<p class="p1"><span class="s1">      const s = { id, symbol, xPct: 0.50, yPct: 0.50, rot: 0, scale: 1 };</span></p>
<p class="p1"><span class="s1">      stickersB.push(s);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      const node = document.createElement("div");</span></p>
<p class="p1"><span class="s1">      node.className = "sticker";</span></p>
<p class="p1"><span class="s1">      node.dataset.id = id;</span></p>
<p class="p1"><span class="s1">      node.textContent = symbol;</span></p>
<p class="p1"><span class="s1">      node.style.fontSize = baseSize + "px";</span></p>
<p class="p1"><span class="s1">      node.style.left = (s.xPct * host.width) + "px";</span></p>
<p class="p1"><span class="s1">      node.style.top  = (s.yPct * host.height) + "px";</span></p>
<p class="p1"><span class="s1">      applyTransformB(node, s);</span></p>
<p class="p1"><span class="s1">      makeTransformableB(node, s);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">      decorLayerB.appendChild(node);</span></p>
<p class="p1"><span class="s1">      setActiveStickerB(id);</span></p>
<p class="p1"><span class="s1">      softChime("place");</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    placeStickerBtnB.addEventListener("click", () =&gt; {</span></p>
<p class="p1"><span class="s1">      const sym = stickerSelectB.value || "🩷";</span></p>
<p class="p1"><span class="s1">      createStickerB(sym);</span></p>
<p class="p1"><span class="s1">    });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    clearStickersBtnB.addEventListener("click", () =&gt; {</span></p>
<p class="p1"><span class="s1">      stickersB.length = 0;</span></p>
<p class="p1"><span class="s1">      decorLayerB.innerHTML = "";</span></p>
<p class="p1"><span class="s1">      activeStickerIdB = null;</span></p>
<p class="p1"><span class="s1">      softChime("gate");</span></p>
<p class="p1"><span class="s1">    });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    decorLayerB.addEventListener("pointerdown", (e) =&gt; {</span></p>
<p class="p1"><span class="s1">      if (e.target === decorLayerB) {</span></p>
<p class="p1"><span class="s1">        activeStickerIdB = null;</span></p>
<p class="p1"><span class="s1">        decorLayerB.querySelectorAll(".sticker").forEach(elm =&gt; (elm.style.outline = "none"));</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">    });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    window.addEventListener("keydown", (e) =&gt; {</span></p>
<p class="p1"><span class="s1">      if (!activeStickerIdB) return;</span></p>
<p class="p1"><span class="s1">      if (e.key === "Backspace" || e.key === "Delete") {</span></p>
<p class="p1"><span class="s1">        removeStickerB(activeStickerIdB);</span></p>
<p class="p1"><span class="s1">        activeStickerIdB = null;</span></p>
<p class="p1"><span class="s1">      }</span></p>
<p class="p1"><span class="s1">    });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    function reflowStickersB() {</span></p>
<p class="p1"><span class="s1">      const host = decorLayerB.getBoundingClientRect();</span></p>
<p class="p1"><span class="s1">      stickersB.forEach(s =&gt; {</span></p>
<p class="p1"><span class="s1">        const node = decorLayerB.querySelector(`[data-id="${s.id}"]`);</span></p>
<p class="p1"><span class="s1">        if (!node) return;</span></p>
<p class="p1"><span class="s1">        node.style.left = (s.xPct * host.width) + "px";</span></p>
<p class="p1"><span class="s1">        node.style.top  = (s.yPct * host.height) + "px";</span></p>
<p class="p1"><span class="s1">        applyTransformB(node, s);</span></p>
<p class="p1"><span class="s1">      });</span></p>
<p class="p1"><span class="s1">    }</span></p>
<p class="p1"><span class="s1">    window.addEventListener("resize", () =&gt; reflowStickersB());</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">    updateAllSoundButtons();</span></p>
<p class="p1"><span class="s1">  &lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
</body>
</html>
